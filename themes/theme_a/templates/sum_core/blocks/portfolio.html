{% load wagtailcore_tags wagtailimages_tags %}

<section id="portfolio-{{ block.id }}" class="py-24 bg-sage-darkmoss text-sage-linen overflow-hidden relative">
    <div class="container mx-auto px-4">
        {# Header Area #}
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 gap-6">
            <div class="max-w-2xl">
                {% if self.eyebrow %}
                    <span class="block font-accent italic text-sage-terra mb-2">{{ self.eyebrow }}</span>
                {% endif %}
                <h2 class="font-display text-4xl md:text-5xl text-sage-linen leading-tight tracking-tight">
                    {{ self.heading|richtext }}
                </h2>
                {% if self.intro %}
                    <p class="mt-4 text-sage-linen/80 max-w-xl">{{ self.intro }}</p>
                {% endif %}
            </div>

            {% if self.view_all_link and self.view_all_label %}
                <div class="shrink-0">
                    <a href="{{ self.view_all_link }}" class="text-sm font-bold uppercase tracking-widest border-b border-sage-terra pb-1 hover:text-sage-terra transition-colors">
                        {{ self.view_all_label }}
                    </a>
                </div>
            {% endif %}
        </div>

        {# Layout Container (Mobile Scroll / Desktop Grid) #}
        <div class="relative">
            <div class="flex overflow-x-auto pb-8 -mx-4 px-4 md:grid md:grid-cols-3 md:gap-8 md:overflow-visible md:pb-0 md:mx-0 md:px-0 snap-x snap-mandatory scroll-smooth">
                {% for item in self.items %}
                    <article class="flex-none min-w-[85vw] mr-6 last:mr-0 md:min-w-0 md:w-auto md:mr-0 snap-start group">
                        {# Image Area #}
                        {% if item.link_url %}<a href="{{ item.link_url }}" class="block">{% endif %}
                            <div class="aspect-[4/3] overflow-hidden rounded-sm bg-sage-black/20 mb-6">
                                {% if item.image %}
                                    {% image item.image fill-1200x900 class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" alt=item.alt_text %}
                                {% endif %}
                            </div>
                        {% if item.link_url %}</a>{% endif %}

                        {# Text Content #}
                        <div class="space-y-4">
                            <h3 class="font-display text-2xl text-sage-linen tracking-tight">
                                {% if item.link_url %}<a href="{{ item.link_url }}" class="hover:text-sage-terra transition-colors">{% endif %}
                                {{ item.title }}
                                {% if item.link_url %}</a>{% endif %}
                            </h3>

                            {# Metadata Grid #}
                            <div class="grid grid-cols-2 gap-y-3 gap-x-4 text-[11px] uppercase tracking-wider">
                                {% if item.constraint or item.material or item.outcome %}
                                    {% if item.constraint %}
                                        <div class="col-span-1">
                                            <span class="block text-sage-terra font-bold mb-0.5">Constraint</span>
                                            <span class="block text-sage-linen/60">{{ item.constraint }}</span>
                                        </div>
                                    {% endif %}
                                    {% if item.material %}
                                        <div class="col-span-1">
                                            <span class="block text-sage-terra font-bold mb-0.5">Material</span>
                                            <span class="block text-sage-linen/60">{{ item.material }}</span>
                                        </div>
                                    {% endif %}
                                    {% if item.outcome %}
                                        <div class="col-span-2 mt-1">
                                            <span class="block text-sage-terra font-bold mb-0.5">Outcome</span>
                                            <span class="block text-sage-linen/60">{{ item.outcome }}</span>
                                        </div>
                                    {% endif %}
                                {% else %}
                                    {# Fallback #}
                                    {% if item.location %}
                                        <div class="col-span-1">
                                            <span class="block text-sage-terra font-bold mb-0.5">Location</span>
                                            <span class="block text-sage-linen/60">{{ item.location }}</span>
                                        </div>
                                    {% endif %}
                                    {% if item.services %}
                                        <div class="col-span-1">
                                            <span class="block text-sage-terra font-bold mb-0.5">Services</span>
                                            <span class="block text-sage-linen/60">{{ item.services }}</span>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>

            {# Mobile Edge Fade Overlay #}
            <div class="pointer-events-none absolute inset-y-0 right-0 w-16 bg-gradient-to-l from-sage-darkmoss to-transparent md:hidden"></div>
        </div>
    </div>
</section>
