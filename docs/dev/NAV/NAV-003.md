## NAV-003 — Implement Navigation Site Settings Models (Header + Footer)

**Type:** Feature
**Priority:** P0
**Owner:** Cursor implementation agent
**Depends on:** NAV-001 (UniversalLinkBlock), NAV-002 (navigation blocks)

### Goal

Create Wagtail **site settings models** for `HeaderNavigation` and `FooterNavigation` using `BaseSiteSetting`, wired to the already-built StreamField blocks, with editor-friendly panels and full model/test coverage.

---

## Scope

### In scope (this ticket)

1. **Models**

   - `HeaderNavigation` site setting model with fields exactly as specified.
   - `FooterNavigation` site setting model with fields exactly as specified.

2. **StreamField wiring**

   - `menu_items` uses `MenuItemBlock` and enforces **max 8 top-level**.
   - `link_sections` uses `FooterLinkSectionBlock` and enforces **min 2, max 4** sections.
   - `header_cta_link` + `mobile_cta_button_link` store a single `UniversalLinkBlock` entry (0–1 items).

3. **Wagtail admin panels**

   - Group fields into sensible `MultiFieldPanel`s for editor UX.

4. **Migrations**

   - Initial migration for these models.

5. **Unit tests**

   - Model-level tests in `tests/navigation/test_models.py` to validate constraints + site uniqueness/isolation.

### Out of scope (later tickets)

- Template tags (`{% header_nav %}`, `{% footer_nav %}`, `{% sticky_cta %}`), cache layer, service-area auto population logic, placeholder replacement logic. (Those come later in the spec’s plan.)

---

## Implementation Notes (important decisions)

### 1) App registration (don’t skip)

Because we’re adding models + migrations, `sum_core.navigation` must be a **real Django app**:

- Add `core/sum_core/navigation/apps.py` (AppConfig).
- Ensure `sum_core.navigation` is present in `INSTALLED_APPS` (wherever this project defines it).
- Add `core/sum_core/navigation/migrations/__init__.py`.

### 2) StreamField constraints (how to enforce)

- Top-level max 8 menu items: enforce via StreamField block count/max config (only one block type, so “block max” == “total max”).
- Footer sections min 2 / max 4: enforce via block count min/max config.
- `header_cta_link` and `mobile_cta_button_link`: enforce 0–1 items similarly.

_(Use the most idiomatic mechanism for the Wagtail version in this repo: `block_counts` / StreamBlock `Meta.min_num/max_num` / field-level validators—whatever is supported.)_

---

## Detailed Requirements

### A) `HeaderNavigation` model

Implement the fields per spec: `menu_items`, `show_phone_in_header`, header CTA fields, and mobile CTA fields.

**Field wiring requirements**

- `menu_items`: StreamField using `MenuItemBlock`, max 8.
- `header_cta_link`: optional StreamField containing a single `UniversalLinkBlock`.
- `mobile_cta_button_link`: optional StreamField containing a single `UniversalLinkBlock`.

### B) `FooterNavigation` model

Implement the fields per spec: `tagline`, `link_sections`, `auto_service_areas`, social URLs, `copyright_text`.

**Field wiring requirements**

- `link_sections`: StreamField using `FooterLinkSectionBlock`, min 2, max 4.

---

## Suggested Admin Panel Layout

Create clean panels to avoid an overwhelming settings screen:

**HeaderNavigation**

- **Main Navigation**

  - `menu_items`
  - `show_phone_in_header`

- **Header CTA**

  - `header_cta_enabled`
  - `header_cta_text`
  - `header_cta_link`

- **Mobile Sticky CTA**

  - `mobile_cta_enabled`
  - `mobile_cta_phone_enabled`
  - `mobile_cta_button_enabled`
  - `mobile_cta_button_text`
  - `mobile_cta_button_link`

**FooterNavigation**

- **Footer Content**

  - `tagline`
  - `link_sections`
  - `auto_service_areas` (toggle only; actual population later)

- **Social Links**

  - `social_facebook`, `social_instagram`, `social_linkedin`, `social_youtube`, `social_x`

- **Copyright**

  - `copyright_text` (placeholder replacement handled later)

---

## Files to Create / Modify

**Create**

- `core/sum_core/navigation/models.py`
- `core/sum_core/navigation/apps.py`
- `core/sum_core/navigation/migrations/__init__.py`
- `core/sum_core/navigation/migrations/0001_initial.py`
- `tests/navigation/test_models.py`

**Modify**

- `core/sum_core/navigation/__init__.py` (export models if that’s the project convention)
- Project settings: add `sum_core.navigation` to `INSTALLED_APPS` (exact file depends on repo layout)

---

## Acceptance Criteria

1. `HeaderNavigation` and `FooterNavigation` exist as `BaseSiteSetting` + `@register_setting` models and appear in Wagtail admin Settings.
2. `HeaderNavigation.menu_items` enforces **max 8** top-level items.
3. `FooterNavigation.link_sections` enforces **min 2 / max 4** sections.
4. All fields from the spec exist with correct types/lengths.
5. Migrations apply cleanly.
6. Unit tests added and passing.

---

## Automated Tests (pytest)

Add `tests/navigation/test_models.py` covering at minimum:

- **Uniqueness / isolation**

  - One settings instance per Site (BaseSiteSetting behavior).
  - Different Sites can store different menus without overlap.

- **Constraints**

  - `menu_items` rejects > 8 items.
  - `link_sections` rejects < 2 and > 4 sections.
  - CTA link StreamFields reject > 1 item (if implemented that way).

---

## Manual QA Steps (Wagtail Admin)

1. **Confirm settings screens exist**

   - Wagtail Admin → **Settings**
   - Verify **Header Navigation** and **Footer Navigation** entries are present (for the current Site).

2. **Header menu max 8**

   - Open **Header Navigation**
   - Add 8 `menu_items` successfully
   - Attempt to add a 9th → confirm the editor prevents save / shows validation.

3. **Footer link sections min/max**

   - Open **Footer Navigation**
   - Try saving with 0–1 sections → confirm validation.
   - Save with 2–4 sections → confirm success.
   - Attempt 5 sections → confirm validation.

4. **Where to verify the UniversalLinkBlock validation messages (your earlier question)**

   - Wagtail Admin → **Settings → Header Navigation**

     - Add a `menu_items` entry
     - Inside its **link** (UniversalLinkBlock), set `link_type` to each option (`page`, `url`, `email`, `phone`, `anchor`)
     - Leave the required destination field blank and click **Save**
     - Confirm the validation error appears on the correct missing field (e.g., selecting `url` requires `url`).

   - Repeat the same check in **Settings → Footer Navigation** inside a section link (UniversalLinkBlock).

---

## Definition of Done

- `make lint` and `make test` pass.
- Models are editable in Wagtail admin and constraints behave as specified.
- Migration committed and clean on a fresh DB.
- Tests added with meaningful coverage around site isolation + constraints.

---
