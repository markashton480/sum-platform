# SUM CLI Documentation

## Quick Links

üìò **[CLI User Guide](./cli/USER_GUIDE.md)** - Complete user documentation for all commands
üîß **[CLI Developer Guide](./cli/DEVELOPER_GUIDE.md)** - Architecture, testing, and development guide

---

## ‚ö†Ô∏è Important: CLI v2 Status

**CLI v2 code exists in this repository but is NOT YET PACKAGED for distribution.**

The documentation below describes CLI v2 features that are available when running from the monorepo (`pip install -e ./cli`), but are **not available** in published packages. The published package still ships CLI v1.

**Current packaging status:**
- ‚úÖ CLI v2 code: Merged in PR #250 (`cli/sum/` directory)
- ‚úÖ CLI v2 tests: 200 tests, 100% coverage
- ‚ùå CLI v2 packaging: Not yet configured in `cli/pyproject.toml`
- ‚ùå CLI v2 distribution: Not yet published

**To use CLI v2 features now:**
```bash
# Clone the repository
git clone https://github.com/markashton480/sum-platform.git
cd sum-platform

# Install in editable mode
pip install -e ./cli

# Verify you have v2
sum init --help  # Should show --full, --quick flags
```

**For published package users:**
The current published package (v0.1.0) provides CLI v1 features only. See "CLI v1 Reference" section below.

---

## CLI v2 Overview (Monorepo Development Only)

The SUM CLI v2 (`sum`) provides three main commands for creating and managing client projects:

- **`sum init`** - Initialize projects with optional full setup (venv, deps, migrations, seed, superuser)
- **`sum run`** - Start development server with automatic port fallback
- **`sum check`** - Validate project setup with comprehensive checks

### What's New in v2

**Notes:**
- The `--theme` flag from v1 is not available in v2 yet. All projects use `theme_a` by default.
- CLI v2 is available in monorepo development mode only (not yet packaged/published)

‚úÖ **Enhanced `sum init`:**
- `--full` mode for complete setup (venv ‚Üí deps ‚Üí migrate ‚Üí seed ‚Üí superuser)
- `--quick` mode for fast scaffolding with virtualenv and dependencies
- Interactive prompts for configuration
- Automatic `.env.local` creation with secure credentials
- Homepage seeding with default content

‚úÖ **New `sum run` command:**
- Automatic virtualenv detection
- Port fallback when default is in use
- Monorepo mode support

‚úÖ **Enhanced `sum check`:**
- Comprehensive validation (venv, packages, database, homepage)
- Status indicators (OK/FAIL/SKIP)
- Remediation guidance for failures

### Quick Start

```bash
# Full setup (recommended)
sum init my-project --full

# Quick setup (scaffolding + venv + deps only)
sum init my-project --quick

# Start development server
sum run my-project

# Validate project
sum check my-project
```

See [CLI User Guide](./cli/USER_GUIDE.md) for complete documentation.

---

## CLI v1 Reference

Below is the legacy v1 documentation for reference.

### SUM CLI (v1): `sum init`, `sum check`

This repo ships a minimal **filesystem scaffolding + validation CLI**.
It intentionally does **not** create virtualenvs, install dependencies, initialise git, or touch databases.

### Install (monorepo dev)

From repo root (using the repo virtualenv):

```bash
source .venv/bin/activate
pip install -e ./cli
```

### `sum init <project-name>`

Creates a new client project at `clients/<project-name>/` by copying the boilerplate and applying deterministic renames:

- client directory name uses the provided slug (e.g. `acme-kitchens`)
- Django project package name is normalized for Python imports (hyphens ‚Üí underscores, e.g. `acme_kitchens`)
- all `project_name` placeholders are replaced
- `.env` is created by copying `.env.example` (no secret generation)

Run from the repo root:

```bash
sum init acme-kitchens
```

### Showroom seeding (`seed_showroom`)

Client projects generated by `sum init` include a Django management command you can run to quickly create a **theme showroom** site tree (pages, blocks, navigation, and branding defaults):

```bash
python manage.py seed_showroom
```

The starter profile is the default; use `--profile showroom` for the full block showcase.

For full documentation, see [`docs/dev/SHOWROOM.md`](./SHOWROOM.md).

### `sum check`

Validates the **current working directory** is a structurally-correct client project.

#### Execution Modes

`sum check` automatically detects its execution context:

**Mode 1: Monorepo dev mode**

When running inside the SUM Platform repository (detected by the presence of `core/` and `boilerplate/` directories with expected markers), the CLI automatically adds the core package to the import path. Output will show:

```
[OK] sum_core import: monorepo mode
```

This allows developers to run `sum check` on scaffolded projects without installing `sum_core` globally.

**Mode 2: Standalone client mode**

When running outside the monorepo (e.g., a client project deployed independently), `sum_core` must be installed via pip. If not installed, the output will show:

```
[FAIL] sum_core import: Install requirements first: pip install -r requirements.txt
```

#### What `sum check` validates

| Check                    | Description                                                  |
| ------------------------ | ------------------------------------------------------------ |
| **Project root**         | `manage.py` exists                                           |
| **Env template**         | `.env.example` exists                                        |
| **Required env vars**    | Keys from `.env.example` are set (via `.env` or environment) |
| **Settings module**      | Inferred from `.env` or `manage.py`, and importable          |
| **Health wiring**        | URLConf includes `sum_core.ops.urls` (string-based check)    |
| **sum_core import**      | `sum_core` package is importable                             |
| **No test_project refs** | No references to `test_project` in project files             |

#### What `sum check` does NOT validate

- Database connectivity or migrations
- Full Django startup / `runserver` success
- Template correctness or static file collection
- Runtime configuration (e.g., email, Celery)
- Whether the health endpoint actually responds

Run from a client project directory:

```bash
cd clients/acme-kitchens
sum check
```

### Boilerplate source resolution

`sum init` uses the canonical repo `/boilerplate/` if present (and valid). If not, it falls back to a boilerplate copy bundled with the CLI package.

You can override the boilerplate path for development:

```bash
SUM_BOILERPLATE_PATH=/path/to/boilerplate sum init acme-kitchens
```

### Boilerplate sync (maintainers)

The CLI bundles a copy of boilerplate for non-monorepo use. To keep it in sync:

```bash
# Sync canonical boilerplate to CLI package
make sync-cli-boilerplate

# Check for drift (CI mode - fails if out of sync)
make check-cli-boilerplate
```

> [!IMPORTANT]
> CI should run `make check-cli-boilerplate` to prevent silent boilerplate drift.

---

## Maintainer Release Notes

When releasing a new version of SUM Platform, follow these steps to keep the CLI and boilerplate in sync.

### When to sync boilerplate

Run `make sync-cli-boilerplate` whenever you modify anything in `/boilerplate/`:

```bash
# After editing boilerplate files
make sync-cli-boilerplate

# Verify sync is clean
make check-cli-boilerplate
```

### Updating `SUM_CORE_GIT_REF`

Before tagging a release, update the boilerplate to pin to the new version:

```bash
make release-set-core-ref REF=v0.1.2
```

This command:

1. Updates `boilerplate/requirements.txt`
2. Syncs CLI boilerplate automatically
3. Verifies drift check passes

### Pre-release checklist

```bash
# Run all release checks
make release-check
```

This runs lint, tests, and drift detection in sequence.

‚Üí See [docs/ops-pack/release-runbook.md](../ops-pack/release-runbook.md) for the full release process.


