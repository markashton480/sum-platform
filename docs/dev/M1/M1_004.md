## **[M1-004] Base Layout Templates & HTML Shell**

### Context (from PRD / Design System / Implementation Plan)

Milestone 1 is about **Design System & Base Templates** – we’ve now got:

* Tokenised CSS in `main.css` (M1-001) 
* `SiteSettings` with branding data + `get_site_settings` tag (M1-002)
* `{% branding_css %}` + `{% branding_fonts %}` driving tokens/fonts from settings (M1-003) 

Next, per the PRD and Implementation Plan, we need a **shared HTML layout** that:

* Uses the design system (tokens, `main.css`)
* Hooks in branding (`branding_css`, `branding_fonts`, SiteSettings info)
* Provides a consistent **header / main / footer** shell for all future pages, matching the Premium Trade reference design’s structure.

Relevant PRD bits:

* **Layout & Navigation user story (US-LYT01)** – calls for a shared base layout with header, nav, main content, and footer, reusable across all client projects. 
* **Appendix B – Template/File structure** – specifies `sum_core/templates/sum_core/base.html` as the core layout, with includes for header, footer, etc. 
* Design spec stresses **section rhythm, spacing, and hierarchy** over colours, which are now token-driven. The base layout should set up containers/sections that respect the “Breath” and “Pinky” rules.

This task is **structural**: no hero/trust strip content yet – just the shell plus hooks.

---

### Technical Requirements

**Overall goal:**

Create the canonical `sum_core` base template (and a couple of partials) that:

* Lives under `sum_core/templates/sum_core/`
* Includes `main.css`, `{% branding_css %}`, `{% branding_fonts %}`
* Exposes well-named blocks for header, main content, and footer
* Uses `SiteSettings` (via `get_site_settings`) for things like site name, favicon, and basic footer info
* Is ready to be extended by client templates and future `Page` models

#### 1. Template structure & paths

Under `core/sum_core/templates/sum_core/`:

* **Create** `base.html`
* **Create** `includes/header.html`
* **Create** `includes/footer.html`

Directory structure:

```text
core/
  sum_core/
    templates/
      sum_core/
        base.html
        includes/
          header.html
          footer.html
```

This matches the PRD’s expectation that shared templates live under `sum_core/templates/sum_core/` and can be overridden by client projects if needed. 

#### 2. `base.html` responsibilities

At the top:

```django
{% load static wagtailcore_tags branding_tags %}
```

**`<head>`**

* `<!DOCTYPE html>` and `<html lang="en">`

* `<meta charset="utf-8">`

* `<meta name="viewport" content="width=device-width, initial-scale=1">`

* `<title>` logic:

  * Use the Wagtail convention:

    ```django
    {% get_site_settings as site_settings %}
    <title>
      {% block title %}
        {% if page %}
          {% firstof page.seo_title page.title %}
        {% else %}
          {{ site_settings.company_name|default:WAGTAIL_SITE_NAME }}
        {% endif %}
      {% endblock %}
    </title>
    ```

* Favicon:

  * If `site_settings.favicon` is set, include:

    ```django
    {% if site_settings.favicon %}
      <link rel="icon" href="{{ site_settings.favicon.get_rendition('fill-32x32').url }}">
    {% endif %}
    ```

  * Keep it minimal; full favicon matrix can come later if needed.

* CSS & branding:

  * Link to `main.css` via staticfiles:

    ```django
    <link rel="stylesheet" href="{% static 'sum_core/css/main.css' %}">
    ```

  * Include fonts and dynamic CSS:

    ```django
    {% branding_fonts %}
    {% branding_css %}
    ```

  * Ensure `branding_css` appears **after** `main.css` so its overrides win.

* Open head block for extensions:

  ```django
  {% block extra_head %}{% endblock %}
  ```

**`<body>`**

Use BEM-style classes, aligned with design_system:

```django
<body class="layout">
  <div class="layout__inner">
    {% include "sum_core/includes/header.html" %}
    <main class="layout__main">
      {% block content %}{% endblock %}
    </main>
    {% include "sum_core/includes/footer.html" %}
  </div>
  {% block extra_body %}{% endblock %}
</body>
```

* This sets up the global structure: header → main → footer within a centered layout.

#### 3. `includes/header.html`

Responsibilities:

* Structural header container that later nav/hero pieces can plug into.
* Read `SiteSettings` for company name and header logo (if set), but keep logic simple.

Example:

```django
{% get_site_settings as site_settings %}
<header class="layout__header site-header">
  <div class="container site-header__inner">
    <a href="/" class="site-header__brand">
      {% if site_settings.header_logo %}
        <img
          src="{{ site_settings.header_logo.get_rendition('height-40').url }}"
          alt="{{ site_settings.company_name|default:'Home' }}"
          class="site-header__logo"
        >
      {% else %}
        <span class="site-header__title">
          {{ site_settings.company_name|default:WAGTAIL_SITE_NAME }}
        </span>
      {% endif %}
    </a>
    {% block primary_nav %}{% endblock %}
  </div>
</header>
```

Notes:

* Uses `.container` and `.site-header*` classes so `main.css` spacing rules apply.
* Leaves `{% block primary_nav %}` empty for now; nav will be another task.

#### 4. `includes/footer.html`

Responsibilities:

* Structural footer with company name, tagline, and optional contact info.
* Keep it minimal but semantically useful.

Example:

```django
{% get_site_settings as site_settings %}
<footer class="layout__footer site-footer">
  <div class="container site-footer__inner">
    <div class="site-footer__brand">
      <div class="site-footer__title">
        {{ site_settings.company_name|default:WAGTAIL_SITE_NAME }}
      </div>
      {% if site_settings.tagline %}
        <div class="site-footer__tagline">
          {{ site_settings.tagline }}
        </div>
      {% endif %}
    </div>
    <div class="site-footer__meta">
      {% if site_settings.phone_number %}
        <div class="site-footer__item">
          {{ site_settings.phone_number }}
        </div>
      {% endif %}
      {% if site_settings.email %}
        <div class="site-footer__item">
          {{ site_settings.email }}
        </div>
      {% endif %}
      {% if site_settings.address %}
        <div class="site-footer__item site-footer__address">
          {{ site_settings.address|linebreaksbr }}
        </div>
      {% endif %}
    </div>
  </div>
</footer>
```

This aligns with PRD’s requirement that business info & contact details be available in layout (BR01 AC5).

No social icons or complex layout yet; those can come in a later milestone.

---

### Design Specifications

From the design_system and Premium Trade reference:

* Use `.container`, `.section`, and typography utility classes from `main.css` wherever appropriate.
* Respect the **Breath** rule (comfortable vertical spacing) by ensuring:

  * Header/footer use spacing tokens (`--space-*`) via `main.css` class definitions.
* Ensure HTML is semantic and accessible:

  * `<header>`, `<main>`, `<footer>` for landmarks.
  * Use `<a>` for brand link to home.
  * Use headings (`h1` in content templates, not in base) – base shell should avoid forcing heading levels.

No inline styles, no hard-coded colours or font families: everything should derive from tokens + branding tags.

---

### Implementation Guidelines

**Files to create/modify**

* Create `core/sum_core/templates/sum_core/base.html`
* Create `core/sum_core/templates/sum_core/includes/header.html`
* Create `core/sum_core/templates/sum_core/includes/footer.html`
* Optionally, add a very minimal CSS section in `main.css` (if not already) for:

  * `.layout`, `.layout__inner`, `.layout__header`, `.layout__main`, `.layout__footer`
  * `.site-header*`, `.site-footer*`

  These must use tokens (`var(--space-*)`, `var(--color-*)`, etc.), not raw values.

**Patterns**

* BEM-ish naming, kebab-case: `site-header__inner`, `site-footer__title`.
* No business logic in templates; only simple rendering and `get_site_settings` usage.
* Keep duplication low by centralising layout in `base.html` and using `{% include %}`.

---

### Acceptance Criteria

* [ ] `core/sum_core/templates/sum_core/base.html` exists and:

  * Loads `static`, `wagtailcore_tags`, and `branding_tags`.
  * Links `sum_core/css/main.css` via `{% static %}`.
  * Calls `{% branding_fonts %}` and `{% branding_css %}` inside `<head>`.
  * Uses `get_site_settings` to access `SiteSettings` and set `<title>` appropriately.
  * Defines `block title`, `block extra_head`, `block content`, and `block extra_body`.

* [ ] `core/sum_core/templates/sum_core/includes/header.html` exists and:

  * Uses `get_site_settings` to show either header logo or company name.
  * Wraps content in `<header>` with `layout__header` and `.container`.
  * Provides `{% block primary_nav %}{% endblock %}` as a hook.

* [ ] `core/sum_core/templates/sum_core/includes/footer.html` exists and:

  * Uses `get_site_settings` to show company name, tagline, and basic contact details when present.
  * Wraps content in `<footer>` with `layout__footer` and `.container`.

* [ ] All templates:

  * Use semantic HTML landmarks (`header`, `main`, `footer`).
  * Use only token-driven CSS classes (no inline styles or hard-coded colours/fonts).

* [ ] `make lint` and `make test` still pass.

---

### Dependencies & Prerequisites

* Milestone 0 complete (env, tooling, test project).
* M1-001 – `main.css` token system implemented.
* M1-002 – `SiteSettings` model and `get_site_settings` tag implemented.
* M1-003 – `{% branding_css %}` and `{% branding_fonts %}` implemented and tested.

---

### Testing Requirements

**Unit / integration tests**

Add tests under `tests/templates/`, for example: `tests/templates/test_base_template.py`.

Recommended tests:

1. **Base template renders with branding**

   * Create a `Site` and `SiteSettings` with:

     * `company_name = "Test Co"`
     * `favicon` optional

   * Render a template that extends `sum_core/base.html`:

     ```django
     {% extends "sum_core/base.html" %}
     {% load branding_tags %}
     {% block content %}Hello{% endblock %}
     ```

   * Assert:

     * `<title>` contains `"Test Co"` and/or page title when `page` is provided.
     * Output contains `<link rel="stylesheet" href="...sum_core/css/main.css">`.
     * Output contains `<style id="branding-css">` or at least `:root {` from `branding_css`.

2. **Header and footer use SiteSettings**

   * Render `{% include "sum_core/includes/header.html" %}` and assert:

     * Company name appears when no logo set.
   * Render `{% include "sum_core/includes/footer.html" %}` and assert:

     * Company name and tagline appear when set.

Mark tests with `pytestmark = pytest.mark.django_db`.

