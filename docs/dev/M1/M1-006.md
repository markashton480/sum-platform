**Task ID**: M1-006 / DESIGN-007
**Title**: Test Project HomePage wired to SUM base layout

**Goal**:
Make the Wagtail test project render a real homepage using the shared `sum_core` base layout and branding system (tokens, SiteSettings, branding tags) instead of the default “Welcome to your new Wagtail site” page.

---

### Workstream

* **Workstream**: 2 – Design System & Base Templates
* **Milestone**: Milestone 1 – Design System & Base Templates

This is a small enabling slice from the “Page Types” epic, pulled forward into Milestone 1 to satisfy the “running test project shows styled base site using token system” outcome.

---

### Inputs Required

**PRD Sections**

* **Epic 2.4 – Page Types → US-P01: Homepage**

  * HomePage is the primary entry point for visitors.
  * ACs mention: `HomePage` model, SEO fields, only one per site, and template rendering blocks with proper spacing.
  * For this task we **only** borrow the naming and “root homepage” idea; full StreamField + SEO mixins come later.

**Implementation Plan**

* Milestone 1 “Done When” includes:

  * “Running test project shows styled base site using token system”
  * “Changing branding values in SiteSettings admin reflects immediately in frontend”
* Workstream 2 description: design system, `SiteSettings`, template tags, base HTML, and a test project that exercises them.

**Design References**

* `core/sum_core/templates/sum_core/base.html` and includes (`header.html`, `footer.html`) – the shell we’ve already built.
* `core/sum_core/static/sum_core/css/main.css` – tokens, layout shell, typography utilities, `.container`, `.section` etc.
* Premium Trade static HTML (`premium-trade-website-v3-final.html`) – overall hierarchy and section rhythm (header → hero → trust strip → content), for **inspiration only**. No need to replicate blocks yet.

**Dependencies**

* Milestone 0 complete (repo structure, tooling, test infra).
* Milestone 1 tasks completed:

  * DESIGN-001 (CSS Token System)
  * DESIGN-003 (SiteSettings Model)
  * DESIGN-004 (Branding Template Tags)
  * DESIGN-005 (Base Layout Templates)
  * DESIGN-006 (Theme Presets)

---

### Files/Modules to Touch

* **New**: `core/sum_core/test_project/home/__init__.py`

  * Package marker for the `home` app in the test project.
* **New**: `core/sum_core/test_project/home/apps.py`

  * Wagtail/Django app config (`HomeConfig` or similar).
* **New**: `core/sum_core/test_project/home/models.py`

  * Defines a minimal `HomePage` Wagtail page type for the test project.
* **New**: `core/sum_core/templates/sum_core/home_page.html`

  * Template for `HomePage`, extending `sum_core/base.html` and using design-system classes.
* **Modify**: `core/sum_core/test_project/test_project/settings.py`

  * Add `home` app to `INSTALLED_APPS`.
* **(Optional for tests)**: `tests/pages/test_home_page.py`

  * Unit/integration tests for the new page type and template.

---

### Implementation Steps

1. **Create `home` app in the test project**

   * Under `core/sum_core/test_project/`, create a `home` package with:

     * `__init__.py`
     * `apps.py`:

       ```python
       """
       Name: Home App Config
       Path: core/sum_core/test_project/home/apps.py
       Purpose: Configure the test project's home app for Wagtail.
       Family: Used only by the sum_core.test_project for development and testing.
       Dependencies: Django, Wagtail.
       """
       from __future__ import annotations

       from django.apps import AppConfig


       class HomeConfig(AppConfig):
           default_auto_field = "django.db.models.BigAutoField"
           name = "home"
       ```
   * Update `core/sum_core/test_project/test_project/settings.py`:

     * Add `"home"` to `INSTALLED_APPS` near the other project apps.

2. **Implement a minimal `HomePage` model**

   * In `core/sum_core/test_project/home/models.py`:

     ```python
     """
     Name: Test Project Home Page Models
     Path: core/sum_core/test_project/home/models.py
     Purpose: Provide a minimal HomePage type for exercising the SUM base layout and branding.
     Family: Used only by sum_core.test_project; client projects will define their own page types later.
     Dependencies: Wagtail Page model, sum_core base template.
     """
     from __future__ import annotations

     from django.db import models
     from wagtail.fields import RichTextField
     from wagtail.models import Page


     class HomePage(Page):
         """
         Minimal homepage for the test project.

         NOTE: This is an enabling stub for Milestone 1 and does NOT yet satisfy
         the full US-P01 Homepage acceptance criteria (StreamField, SEO mixins, etc.).
         Those will be implemented in the Page Types milestone.
         """

         intro: RichTextField = RichTextField(blank=True)

         content_panels = Page.content_panels + [
             # Standard Wagtail inline panel import pattern:
             # from wagtail.admin.panels import FieldPanel  (top of file)
             # ...
             # FieldPanel("intro"),
         ]

         template: str = "sum_core/home_page.html"
     ```

   * Use type hints for fields and `template`.

   * Keep this model **test-project-only**; production page mixins and StreamFields come in later milestones.

3. **Create `home_page.html` template**

   * Add `core/sum_core/templates/sum_core/home_page.html`:

     ```django
     {% extends "sum_core/base.html" %}
     {% load wagtailcore_tags %}

     {% block content %}
       <section class="section section--hero">
         <div class="container">
           <h1 class="heading-xl">
             {{ page.title }}
           </h1>
           {% if page.intro %}
             <div class="text-body">
               {{ page.intro|richtext }}
             </div>
           {% endif %}
         </div>
       </section>
     {% endblock %}
     ```

   * This should:

     * Use `.section` and `.container` from `main.css`.
     * Use typography utility classes (`heading-xl`, `text-body`).
     * Avoid any hardcoded colours or fonts (everything flows from tokens + branding tags).

4. **Ensure Wagtail uses this page type**

   * No URL changes needed; Wagtail routing is already wired (`path("", include(wagtail_urls))`).
   * After migration, editors will be able to:

     * Create a `HomePage` under the root.
     * Set it as the site root page via Wagtail’s **Settings → Sites** screen.

5. **Create and run migration for the `home` app**

   * From the repo root (with the main venv active), run:

     ```bash
     python core/sum_core/test_project/manage.py makemigrations home
     python core/sum_core/test_project/manage.py migrate
     ```
   * This ensures `HomePage` is registered and available in the admin.

6. **Unit/integration tests**

   * Add `tests/pages/test_home_page.py` with:

     ```python
     """
     Name: Home Page Tests
     Path: tests/pages/test_home_page.py
     Purpose: Validate the test project's HomePage type and its integration with the SUM base template.
     Family: Part of the page-level test suite exercising the design system.
     Dependencies: Wagtail Site & Page models, home.HomePage, sum_core templates.
     """
     from __future__ import annotations

     from types import SimpleNamespace

     import pytest
     from django.template import RequestContext, Template
     from django.test import RequestFactory
     from wagtail.models import Page, Site

     from home.models import HomePage


     pytestmark = pytest.mark.django_db


     def test_home_page_can_be_created_under_root() -> None:
         root = Page.get_first_root_node()
         homepage = HomePage(title="Test Home", slug="home")
         root.add_child(instance=homepage)

         site = Site.objects.get(is_default_site=True)
         site.root_page = homepage
         site.save()

         assert HomePage.objects.filter(title="Test Home").exists()


     def test_home_page_template_uses_sum_core_base() -> None:
         root = Page.get_first_root_node()
         homepage = HomePage(title="Test Home", slug="home")
         root.add_child(instance=homepage)

         site = Site.objects.get(is_default_site=True)
         site.root_page = homepage
         site.save()

         request = RequestFactory().get("/", HTTP_HOST=site.hostname or "localhost")
         template = Template(
             "{% extends 'sum_core/home_page.html' %}"
             "{% block content %}<p>Content</p>{% endblock %}"
         )
         rendered = template.render(RequestContext(request, {"page": homepage}))

         assert "sum_core/css/main.css" in rendered
         assert "<header" in rendered
         assert "<footer" in rendered
     ```

   * The first test ensures the page is creatable and assignable as root.

   * The second test ensures the home template path is valid and the base layout is in play (CSS link + header/footer present).

   * Adjust assertions if needed depending on the exact markup.

7. **Run tests and lint**

   * From repo root:

     ```bash
     make lint
     make test
     ```
   * Fix any issues in new files (type hints, imports, header comments).

8. **Manual verification**

   * Run the dev server:

     ```bash
     python core/sum_core/test_project/manage.py runserver
     ```
   * In Wagtail admin:

     * Create a `HomePage` under the root (via Pages → Root → Add Child → HomePage).
     * Set it as the site’s homepage (Settings → Sites → default site → set root page).
     * Go to `http://127.0.0.1:8000/`:

       * You should see your `HomePage` rendered with:

         * SUM header/footer
         * Typography and layout from `main.css`
         * Colours and fonts reflecting `SiteSettings` + theme presets.

---

### Acceptance Criteria

* [ ] `HomePage` model exists in `home.models` within the test project and is registered with Wagtail.
* [ ] `home` app is in `INSTALLED_APPS` and migrations apply cleanly.
* [ ] Template `sum_core/home_page.html` extends `sum_core/base.html` and uses `.section`/`.container` + typography utilities.
* [ ] Editors can create a `HomePage` under the root in Wagtail admin and set it as the default site root.
* [ ] Visiting `/` in the test project shows the new HomePage (not the default Wagtail welcome screen).
* [ ] HomePage rendering clearly uses:

  * `main.css` via `{% static 'sum_core/css/main.css' %}`
  * Dynamic fonts via `{% branding_fonts %}`
  * Dynamic tokens via `{% branding_css %}`
* [ ] All new tests in `tests/pages/test_home_page.py` pass.
* [ ] `make lint` passes with no new issues.

---

### Testing Requirements

* **Unit/Integration Tests**

  * `tests/pages/test_home_page.py`:

    * Creation and assignment of `HomePage` as site root.
    * Template rendering confirms linkage to `sum_core/base.html` and presence of CSS + header/footer.
  * Ensure existing branding/template tests remain green.

* **Manual checks**

  * Admin: can see and add `HomePage` as a child of root.
  * Admin: can set `HomePage` as default site root.
  * Frontend: `/` shows branded layout with header, footer, and correctly styled title/intro.

---

### Context Bundle for AI

* PRD v1.1:

  * Section 2.4 “Page Types” → US-P01: Homepage (one homepage per site, main entry page, eventual StreamField body and SEO fields).
* Implementation Plan v1.0:

  * Milestone 1 – Design System & Base Templates “Done When”:

    * Running test project shows styled base site using token system.
    * Changing branding values in SiteSettings reflects immediately in frontend.
* Existing code:

  * `core/sum_core/test_project/test_project/settings.py` (INSTALLED_APPS, Wagtail setup).
  * `core/sum_core/test_project/test_project/urls.py` (includes `wagtail_urls`).
  * `core/sum_core/templates/sum_core/base.html`, `includes/header.html`, `includes/footer.html`.
  * `core/sum_core/static/sum_core/css/main.css`.
  * Branding-related tests in `tests/branding/` for style and test patterns.

---

### Estimated Effort

* **Estimated Effort**: S (2–3 hours)

  * Small new app + minimal page model
  * One template, one migration, a couple of tests, and manual verification.
