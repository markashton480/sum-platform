**Task ID**: M2-006 / BLOCKS-006
**Title**: Trust & Stats Blocks (TrustStripBlock + StatsBlock)

---

### Goal

Implement the **trust & social proof blocks** (`TrustStripBlock` and `StatsBlock`) so editors can add credibility elements (logos, badges, and key stats) to any page via `PageStreamBlock`, fully styled via the SUM design token system.

---

### Background & Context (from PRD / Initiation)

**From PRD v1.1 – US-B05: Trust & Social Proof Blocks**

> As a content editor, I want trust-building blocks so that I can establish credibility with visitors.

Key acceptance criteria:

- `TrustStripBlock`: horizontal row of logos/badges (certifications, associations)

  - Min 2, max 8 items
  - Each item has image and optional link

- `StatsBlock`: 2–4 number statistics

  - Each stat has number, label, optional prefix/suffix (e.g. “+”, “yrs”)
  - Optional number animation on scroll into view (P1 – nice-to-have)

- Unit tests for both block types

- Follows Design reference in `premium-trade-website-v3-final.html` trust strip.

These blocks are central to the **“trust frame”** in the premium trade layout (appearing near the top of the homepage and/or in key conversion sections).

**From Implementation Plan – Milestone 2 / BLOCKS-006**
Milestone 2 covers all StreamField blocks; this task corresponds to:

- `BLOCKS-006 | Trust and Stats Blocks | M (4–5h)`
- Depends on **BLOCKS-001–005** (base block infra, hero, services, testimonials, CTA blocks) being in place.

**Design intent (from design system + reference layout)**

- Trust strip is a **thin, understated band** with a small eyebrow (“Trusted by”) and a row of logos. It should feel light and “breathable”, not shouty.
- Stats are usually **3–4 bold numbers** in a row with short labels, used either:

  - Directly under hero, or
  - Paired with testimonials/CTA.

- Both blocks must use **shared typography + spacing utilities** (no bespoke styles per block) and **never hard-code fonts or colors** – everything flows through tokens and existing utility classes.

---

### Scope

**In-scope**

- Define new Wagtail blocks for trust strip + stats.
- Wire them into the `PageStreamBlock` used by `HomePage`.
- Implement templates that:

  - Follow the Premium Trade structure.
  - Use **existing design tokens and utilities** (CSS implementation guide).

- Add minimal JS hook for optional number-animation (CSS-only acceptable; full animation can be P1 behind a safe feature flag / data-attribute).
- Add unit tests for:

  - Block structure & constraints.
  - Integration rendering within a page.

**Out-of-scope**

- Full-blown animation library or complex intersection observers (a simple stub/hook is enough here; we can enhance later).
- Any lead/analytics or schema markup (belongs to later milestones).

---

### Deliverables

1. **Block definitions**

   - `core/sum_core/blocks/trust.py`

     - `TrustStripItemBlock`
     - `TrustStripBlock`
     - `StatItemBlock`
     - `StatsBlock`

   - Exports via:

     - `core/sum_core/blocks/__init__.py`
     - `PageStreamBlock` in `core/sum_core/blocks/base.py` (or equivalent)

2. **Templates**

   - `core/sum_core/templates/sum_core/blocks/trust_strip.html`
   - `core/sum_core/templates/sum_core/blocks/stats.html`

3. **Styling (using token system)**

   - Extend `core/sum_core/static/sum_core/css/main.css` with **block-specific classes** ONLY where necessary:

     - `.trust-strip`, `.trust-strip__inner`, `.trust-strip__eyebrow`, `.trust-strip__logos`, `.trust-strip__logo`
     - `.stats`, `.stats__grid`, `.stat`, `.stat__value`, `.stat__label`, `.stat__prefix`, `.stat__suffix`

   - Re-use shared section/layout styles where possible:

     - `.section`, `.section--tight`, `.section--muted`
     - Shared heading/eyebrow utilities defined so far (`.heading-xl`, `.heading-lg`, `.text-muted`, etc.)

4. **Tests**

   - `tests/blocks/test_trust_blocks.py` (or similar name)
   - Update `tests/blocks/test_page_streamblock.py` to assert new child blocks exist.
   - Optional integration test:

     - `tests/templates/test_homepage_trust_blocks.py`
       or expand existing homepage rendering tests to include trust/stats.

5. **Developer notes**

   - Update `docs/dev/M2/M2-006.md` (or equivalent) with a brief summary, usage notes, and any nuances for other agents.

---

### Technical Requirements

**Block design (Wagtail)**

- `TrustStripItemBlock` (StructBlock):

  - `logo`: `ImageChooserBlock(required=True)`
  - `alt_text`: `CharBlock(required=True, max_length=255)`
  - `url`: `URLBlock(required=False)` (for linking out to association site)

- `TrustStripBlock` (StructBlock):

  - `eyebrow`: `CharBlock(required=False, help_text="e.g. 'Trusted by'")`
  - `items`: `ListBlock(TrustStripItemBlock, min_num=2, max_num=8)`
  - `Meta`:

    - `icon = "group"` or similar
    - `label = "Trust strip"`
    - `template = "sum_core/blocks/trust_strip.html"`

- `StatItemBlock` (StructBlock):

  - `value`: `CharBlock(required=True, help_text="Raw number, e.g. '500+'")`

    - Keep this as `CharBlock` so we can support “500+” / “15+” etc; do not over-constrain.

  - `label`: `CharBlock(required=True, help_text="Short description, e.g. 'Projects completed'")`
  - `prefix`: `CharBlock(required=False, max_length=10)` (e.g. “>” or “+”)
  - `suffix`: `CharBlock(required=False, max_length=10)` (e.g. “yrs”)

- `StatsBlock` (StructBlock):

  - `eyebrow`: `CharBlock(required=False, help_text="e.g. 'By the numbers'")`
  - `intro`: `TextBlock(required=False)`
  - `items`: `ListBlock(StatItemBlock, min_num=2, max_num=4)`
  - `Meta`:

    - `icon = "pick"` or `icon = "snippet"`
    - `label = "Stats"`
    - `template = "sum_core/blocks/stats.html"`

**StreamField integration**

- Ensure `PageStreamBlock` includes the new blocks:

  - `trust_strip = TrustStripBlock(group="Sections")`
  - `stats = StatsBlock(group="Sections")`

- Name keys in `child_blocks` exactly as above (`"trust_strip"`, `"stats"`) for consistency and testing.

**Template structure**

- `trust_strip.html`:

  - Wrapped in a `.section` with appropriate modifier, e.g.:

    ```html
    <section class="section section--muted trust-strip">
      <div class="container trust-strip__inner">
        {% if self.eyebrow %}
        <p class="section-eyebrow trust-strip__eyebrow">{{ self.eyebrow }}</p>
        {% endif %}
        <div class="trust-strip__logos">
          {% for item in self.items %}
          <div class="trust-strip__logo">
            {% image item.logo fill-200x80 alt=item.alt_text %}
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    ```

  - Use existing `.container`, `.section` utilities. Don’t re-invent them.

- `stats.html`:

  - Similar `.section` wrapper with grid layout for stats:

    ```html
    <section class="section stats">
      <div class="container">
        {% if self.eyebrow %}
        <p class="section-eyebrow stats__eyebrow">{{ self.eyebrow }}</p>
        {% endif %} {% if self.intro %}
        <div class="section-intro text-muted">
          {{ self.intro|linebreaksbr }}
        </div>
        {% endif %}
        <div class="stats__grid">
          {% for item in self.items %}
          <div class="stat">
            <div class="stat__value">
              {% if item.prefix %}<span class="stat__prefix"
                >{{ item.prefix }}</span
              >{% endif %}
              <span class="stat__number">{{ item.value }}</span>
              {% if item.suffix %}<span class="stat__suffix"
                >{{ item.suffix }}</span
              >{% endif %}
            </div>
            <div class="stat__label">{{ item.label }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    ```

  - Use typography utilities for value/label rather than raw font sizes where possible.

**CSS constraints (per CSS implementation guide)**

- **All colors via tokens**:

  - Use `var(--color-text)`, `var(--color-text-muted)`, `var(--color-surface-muted)`, etc.
  - Backgrounds use `var(--color-surface)` / `var(--color-surface-alt)` or existing semantic tokens (e.g. section modifiers).

- **Typography via utilities**:

  - Use `.heading-lg` / `.heading-md` / `.text-sm` etc., not new font-size declarations unless absolutely necessary.

- **Spacing via tokens**:

  - `margin`, `padding`, `gap` should use `var(--space-*)`.

- **No inline styles**, no hard-coded hex or font families.

---

### Implementation Steps

1. **Create block definitions**

   - Add `trust.py` in `core/sum_core/blocks/` with the four blocks (`TrustStripItemBlock`, `TrustStripBlock`, `StatItemBlock`, `StatsBlock`).
   - Follow existing header-comment pattern:

     ```python
     """
     Name: Trust & Stats Blocks
     Path: core/sum_core/blocks/trust.py
     Purpose: StreamField blocks for trust strip logos and numeric stats.
     Family: Used by PageStreamBlock and homepage templates.
     Dependencies: wagtail.blocks, wagtail.images, sum_core.blocks.base.
     """
     ```

   - Add exports to `core/sum_core/blocks/__init__.py`.
   - Wire into `PageStreamBlock` (base block module).

2. **Build templates**

   - Add `trust_strip.html` and `stats.html` under `core/sum_core/templates/sum_core/blocks/`.
   - Use existing section/container/typography utilities from `main.css`.
   - Ensure no duplicated heading patterns (i.e. do NOT add bespoke `trust_heading`, `stats_heading` styles – use shared section heading utilities).

3. **Add styling**

   - In `main.css`, add small, focused rules for `.trust-strip*` and `.stats*`:

     - Layout (flex/grid for logos/stats).
     - Alignment & gaps.
     - Responsive tweaks:

       - Logos wrap nicely on small screens.
       - Stats grid: e.g. 2 columns on tablet, 1 on mobile, 3–4 on desktop.

   - Reuse existing animation utilities if adding subtle “reveal” animations; no new animation system.

4. **Implement tests**

   - `tests/blocks/test_trust_blocks.py`:

     - Assert min/max constraints on list blocks.
     - Assert required fields.
     - Ensure `Meta.template` paths match templates.

   - Update `tests/blocks/test_page_streamblock.py`:

     - Assert `"trust_strip"` and `"stats"` keys exist in `PageStreamBlock().child_blocks`.

   - Optional integration test:

     - Create a `HomePage` with both blocks populated and assert rendered HTML contains expected classes and content.

5. **Documentation / dev notes**

   - Update `docs/dev/M2/M2-006.md` with:

     - Fields and constraints for each block.
     - Example usage snippets.
     - Notes for how to style headings using shared utilities.

---

### Acceptance Criteria

- [ ] `TrustStripBlock` and `StatsBlock` are defined in `core/sum_core/blocks/trust.py` with correct fields and constraints (per PRD US-B05).
- [ ] `PageStreamBlock` exposes `trust_strip` and `stats` keys with appropriate `group="Sections"`.
- [ ] Templates `trust_strip.html` and `stats.html` render without errors and use **only** design tokens + existing utilities (no hard-coded colors/fonts, no inline styles).
- [ ] Trust strip renders a responsive row of 2–8 logos; stats render 2–4 metrics in a responsive grid.
- [ ] On a sample `HomePage`, both blocks can be added, edited, and previewed correctly in Wagtail admin.
- [ ] New unit tests for trust/stats blocks pass.
- [ ] Existing tests continue to pass (`make test` green).

---

### Testing Requirements

**Unit tests**

- Block-level tests:

  - Validate `min_num` / `max_num` on trust items and stats items.
  - Validate required vs optional fields.
  - Confirm `Meta.template` values.

- PageStreamBlock tests:

  - Assert presence of `trust_strip` and `stats`.

**Integration tests (preferred)**

- Create a `HomePage` via factory or directly, attach a body containing:

  - One `trust_strip` block with 2–3 items.
  - One `stats` block with 3–4 items.

- Render via client (`client.get(home.url)`) and assert:

  - `class="trust-strip"` present.
  - `class="stats"` and `class="stats__grid"` present.
  - Logos and stat labels/numbers appear in HTML.

**Manual testing**

- In Wagtail admin:

  - Add Trust Strip & Stats blocks to homepage.
  - Add different numbers of items (test min/max boundaries).
  - Resize viewport (mobile/tablet/desktop) and ensure layout is clean and readable.
  - Change typography/brand settings in `SiteSettings` and confirm trust/stats follow them (no rogue fonts/colors).

---

### Dependencies & Prerequisites

- Milestone 0 & 1 complete (core infra + design system).
- Milestone 2 tasks:

  - **M2-001 / BLOCKS-001** – Base block infrastructure.
  - **M2-002 / BLOCKS-002** – Hero blocks.
  - **M2-003 / BLOCKS-003** – Service cards.
  - **M2-004 / BLOCKS-004** – Testimonials.
  - **M2-005 / BLOCKS-005** – CTA blocks.

- CSS implementation guide available at `docs/dev/design/css-implementation-guide.md`.
- Design reference in `premium-trade-website-v3-final.html` trust strip.

---

### Estimated Complexity

- **Time**: M (4–5 hours)
- **Risk**: Medium

  - Touches `PageStreamBlock`, CSS, and templates.
  - Potential styling drift if token guidelines aren’t followed; mitigated by emphasising the implementation guide and reusing shared utilities.

---

When you’re ready, you can drop this into `docs/dev/M2/M2-006.md` and hand it to your next coding agent.
