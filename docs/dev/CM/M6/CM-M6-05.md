# **[CM-M6-05]: Adopt v0.6 Theme-Owned Rendering Contract (Forward Cut)**

## **Objective**

Implement a **new rendering contract for SUM v0.6** in which **themes are the primary owners of layout and page templates**, replacing the legacy v0.5 model where core templates owned layout and themes attempted to override them.

This CM is a **forward cut**, not a retrofit.

After this CM:

* Theme A defines the canonical rendering shape
* Page models reference **theme-scoped template slots**
* Core templates become fallback/minimal only
* Theme rendering no longer relies on template shadowing or test harness hacks

---

## **Context (Why this CM exists)**

During M6-003 and subsequent corrective work, repeated complexity and failure arose from trying to:

* Build a **Tailwind-first, theme-owned frontend**
* Force it to conform to **v0.5 core-owned templates**
* Validate rendering using a **neutral test harness** that never runs `sum init`

This led to:

* illegal harness hacks
* template shadowing gymnastics
* brittle tests
* agents “cheating” to make rendering appear correct

**Root cause**:
v0.5 assumes *core owns layout*.
v0.6 requires *themes to own layout*.

Trying to retrofit v0.6 themes onto the v0.5 rendering shape has proven counter-productive.

---

## **Authoritative Decision (Already Made)**

Starting in **v0.6**:

* **Themes own layout and page templates**
* **Page models must not hard-bind to `sum_core/...` template paths**
* **Theme A defines the reference rendering shape**
* **v0.5 rendering behaviour is considered legacy and is not preserved**

This is acceptable because:

* SUM is pre-v1
* there are no external consumers
* a major frontend paradigm shift (CSS Tokens → Tailwind) has already occurred
* platform clarity outweighs backwards compatibility at this stage

---

## **New Rendering Contract (v0.6)**

### **Template paths used by models**

**Legacy (v0.5 – deprecated):**

```python
template = "sum_core/standard_page.html"
```

**New (v0.6 – required):**

```python
template = "theme/standard_page.html"
```

### **Resolution rules**

At runtime, `theme/...` resolves to:

```
theme/active/templates/theme/standard_page.html
```

Fallback (only if missing):

```
sum_core/templates/theme/standard_page.html
```

There is **no path shadowing** of `sum_core/...` templates.

> ⚠️ Template loader logic already exists from prior theme work.
> **Do not introduce new loaders.** This CM only changes template paths and locations.

---

## **Explicit Rules**

### ❌ Illegal after this CM

* Hardcoded `sum_core/...` template paths in **v0.6 page models**
* Template path shadowing as a primary mechanism
* Modifying `test_project` settings or models to “help” themes
* Adding themes to `INSTALLED_APPS` for precedence tricks
* Validating themes via harness manipulation

### ✅ Legal and expected

* Page models reference `theme/...` templates
* Themes provide canonical templates
* Core templates are fallback/minimal only
* Theme A is treated as the reference implementation
* Tests validate rendering through the new contract

---

## **Technical Requirements**

### **1. Update v0.6 Page Models**

Apply **only** to the following page models:

* `HomePage`
* `StandardPage`
* `ServiceIndexPage`
* `ServicePage`

For each:

* Update `template` to use:

  ```
  theme/<page_name>.html
  ```
* Do **not** modify any other page models
* Add a short comment indicating this is the v0.6 rendering contract

Do **not** retrofit v0.5 models.

---

### **2. Update Theme A to the New Shape**

Move Theme A templates to:

```
core/sum_core/themes/theme_a/templates/theme/
```

Theme A must provide at least:

```
theme/
├── base.html
├── home_page.html
├── standard_page.html
├── service_index_page.html
├── service_page.html
└── includes/
    ├── header.html
    ├── footer.html
    └── sticky_cta.html
```

These templates:

* define layout and structure
* include all required DOM hooks for JS behaviour (e.g. `id="main-header"`)
* do **not** rely on overriding `sum_core/...` templates

Theme A is now the **authoritative example** for all future themes.

---

### **3. Reduce Core Templates to Fallback Only**

* Do **not** delete core templates
* Move or adjust them so they live under:

  ```
  sum_core/templates/theme/
  ```
* Keep them minimal and safe
* Add comments noting they are fallback / legacy

Core templates must no longer be the primary rendering path.

---

### **4. Simplify and Legalise Tests**

* Remove all hacks previously introduced to validate themes:

  * no harness manipulation
  * no app reordering
  * no model overrides
* Update or add tests to:

  * render pages using the new `theme/...` contract
  * assert required DOM hooks exist

At least one test must:

* render a page
* assert HTTP 200
* assert presence of a Theme A–specific hook (e.g. `id="main-header"`)

`test_project` must remain neutral.

---

## **Acceptance Criteria**

* [ ] Listed v0.6 page models reference `theme/...` templates
* [ ] Theme A renders pages via the new contract
* [ ] Core templates are fallback-only
* [ ] No harness hacks exist
* [ ] No template shadowing is used
* [ ] All tests pass
* [ ] `make lint` passes

---

## **Estimated Complexity**

* **Time**: M
* **Risk**: Medium (contract change, pre-v1, contained)
* **Suggested Model**: **GPT-5.2 (extra thinking enabled)**

---

## **Lead Note (Read Last)**

This CM intentionally **cuts forward**.

Do not attempt to preserve v0.5 rendering behaviour unless explicitly instructed.
If something becomes simpler by dropping legacy assumptions, that is a **feature**, not a regression.

Theme A defines the future shape of SUM.

---
