### 1) Boilerplate default dependency strategy conflicts with M5 distribution decision

The boilerplate `requirements.txt` uses an editable monorepo install (`-e ../../core`).
That’s great for _monorepo dev_, but the “golden path” for real clients in M5 is **git tag pinning** (v1). If boilerplate defaults to `-e`, it nudges people into the wrong mental model and will cause drift.

**Fix:** make boilerplate default to **git tag pinning** (with a placeholder like `SUM_CORE_GIT_REF`), while keeping an explicitly-documented “monorepo dev mode” option.

---

### 2) Health test mocks the thing we most need to validate

The boilerplate health tests “mock `get_health_status` for stability.”
This reduces the test’s value as an **integration wiring** proof: it no longer confirms the real contract/semantics we just locked in CM-006 (ok/degraded=200, unhealthy=503). We _already_ decided to avoid brittle tests, but mocking the core function is too far the other way.

**Fix:** keep the test “non-brittle,” but remove the mock:

- assert `GET /health/` returns JSON with `status` + `checks`
- assert HTTP status aligns with the contract (at least for the healthy baseline)
- don’t assert exact checks ordering or full payload contents

---

### 3) Repo-level mypy exclude is too broad

They excluded `boilerplate/` and `clients/` from mypy at repo root to avoid duplicate module conflicts.
Excluding **boilerplate** is fine. Excluding **clients/** might be too blunt: it means we lose type-signal on the canonical consumer (`clients/sum_client`) inside CI _unless there’s a separate client-level mypy pipeline_ (there isn’t yet).

**Fix:** narrow the exclude to:

- `boilerplate/**`
- optionally `clients/**` _except_ `clients/sum_client/**` (or run a dedicated `clients/sum_client` typecheck target later)

If the “duplicate tests module” is the root issue, we can also fix it by making boilerplate tests not importable as `tests.*` at repo scope (e.g., `boilerplate/project_tests/`), but the simplest is narrowing mypy scope.

---

# ✅ Corrective Mission Ticket

## **[CM-007]: Harden boilerplate for M5 factory use (pinning, health test realism, mypy scope)**

**Objective**: Ensure the new `/boilerplate/` is truly “ship-ready template material” for real client sites by:

1. Aligning dependency defaults with **git tag pinning** (while keeping monorepo dev mode documented).
2. Making the boilerplate health test validate **real wiring + real contract**, not a mocked core function.
3. Tightening repo-level mypy excludes so we don’t accidentally drop type coverage for canonical consumers.

---

## Context

- Boilerplate was created under `feat/m5-002-boilerplate` and uses `project_name` placeholders; greps confirm no `test_project` and no `sum_client` leaks.
- Current boilerplate `requirements.txt` is monorepo-editable install by default.
- Boilerplate health test currently mocks core health internals, which weakens the intended wiring proof.
- Root `pyproject.toml` mypy excludes were expanded to include both `boilerplate/` and `clients/` to avoid module conflicts.

---

## Technical Requirements

### 1) Boilerplate dependency pinning (default path)

- Update `boilerplate/requirements.txt` so the **default** is **git tag pinning** for `sum_core` (placeholder ref).

  - Example approach (pick one pattern and standardize):

    - `sum-core @ git+ssh://git@github.com/<ORG>/<REPO>.git@v0.x.y#subdirectory=core`
    - or `git+https://...@v0.x.y#subdirectory=core` for non-SSH environments

- Keep an explicit “Monorepo development mode” section in `boilerplate/README.md` that describes switching to `-e ../../core` locally.

**Acceptance**: a brand-new external client can use boilerplate without needing monorepo structure.

### 2) Health test: remove mock, keep non-brittle assertions

- Update `boilerplate/tests/test_health.py`:

  - Remove mocking of `get_health_status` (or any core health internals).
  - Assert:

    - response is JSON
    - contains `status` and `checks`
    - HTTP status is `200` in the default/healthy baseline

  - Avoid asserting check ordering or exhaustive payload.

### 3) Mypy exclude tightening

- Adjust root `pyproject.toml`:

  - Exclude `boilerplate/**` from mypy.
  - Prefer **not** excluding all of `clients/**` unless there is a replacement check.
  - If conflicts persist due to duplicate `tests` package names:

    - Either narrow mypy targets to core-only and add a **separate** mypy target for `clients/sum_client`,
    - Or rename boilerplate tests folder to avoid global module collisions.

**Acceptance**: `make lint` still works, but we don’t “silently drop” type signal for canonical client(s).

---

## Files to modify

- `boilerplate/requirements.txt`
- `boilerplate/README.md`
- `boilerplate/tests/test_health.py`
- `pyproject.toml`

---

## Testing Requirements

- Run:

  - `make lint`
  - `make test`

- Additionally:

  - From `boilerplate/` (optional but ideal): run its test invocation pattern (documented in boilerplate README) to confirm it behaves like a standalone project.

---

## Acceptance Criteria

- Boilerplate default install path reflects **git tag pinning** strategy; monorepo `-e` remains documented, not default.
- Boilerplate `/health/` test validates the actual endpoint contract without mocking core health.
- Mypy configuration no longer globally excludes `clients/**` unless we introduce a compensating client mypy target.
- No regressions: `make lint` and `make test` pass.

---

## Estimated Complexity

- Time: **S**
- Risk: **Low–Medium** (config + dev ergonomics)
- Suggested Model: **Claude Sonnet / GPT-5.1** (straightforward, but needs careful config judgment)
