## **[M5-003]: Implement CLI v1 (`sum init`, `sum check`) using boilerplate**

**Objective**
Create the **v1 SUM CLI** that enables:

- deterministic client project creation (`sum init`)
- environment & wiring validation (`sum check`)

This is **scaffolding + validation only**.
No deployment, no content generation, no magic.

---

## Context (Locked Decisions)

- `/boilerplate/` is the **single canonical source** for new client projects (M5-002, CM-07).
- Distribution strategy is **git tag pinning** (v1).
- CLI scope is intentionally minimal:

  - `sum init`
  - `sum check`

- Content population happens via `manage.py` commands, **not** the CLI.
- CLI must not assume monorepo structure at runtime.

---

## Mental Model (Must Be Followed)

```
sum_core      → reusable platform (never client-specific)
boilerplate   → copy source
clients/*     → instantiated projects
CLI           → filesystem + validation only
```

The CLI:

- **copies**
- **names**
- **checks**
- **exits clearly**

Nothing more.

---

## Technical Requirements

### 1. CLI structure

- CLI entrypoint: `sum` (Python console script)
- Commands:

  - `sum init <project_name>`
  - `sum check`

No subcommands beyond these two.

---

### 2. `sum init`

**Behavior**

- Copies `/boilerplate/` → `clients/<project_name>/`
- Replaces placeholders:

  - `project_name`
  - settings module path

- Does **not**:

  - create venv
  - install dependencies
  - initialise git
  - touch databases

**Decisions the agent must make (explicitly allowed)**

- How to safely rename Django project paths
- How to prevent accidental overwrite
- How to validate project name (slug rules)

**Must fail loudly if**

- Target directory exists
- Project name is invalid
- Boilerplate missing or malformed

---

### 3. `sum check`

**Purpose**
Validate that a client project is _structurally correct_.

**Checks (minimum)**

- Required env vars present (from `.env.example`)
- Settings module importable
- `/health/` resolves
- `sum_core` importable
- No references to `test_project`

**Output**

- Human-readable checklist
- Clear pass/fail exit code
- No stack traces on expected failures

---

## Implementation Guidelines

**Files likely involved**

- `cli/` (new or existing)
- `cli/commands/init.py`
- `cli/commands/check.py`
- `pyproject.toml` (console_scripts)
- `docs/dev/cli.md` (new)

**Standards**

- Python type hints everywhere
- No Django imports in CLI unless strictly necessary
- CLI must work outside the monorepo
- Clear, boring, explicit logic

---

## Acceptance Criteria

- `sum init foo` creates `clients/foo/` that:

  - matches boilerplate exactly (modulo naming)
  - passes `sum check`

- `sum check`:

  - fails on missing env vars
  - fails on broken imports
  - passes on a valid client

- CLI behavior is deterministic and documented
- No changes required to `sum_core`

---

## Testing Requirements

- Unit tests for:

  - path handling
  - placeholder replacement
  - validation failures

- One integration-style test:

  - temp dir
  - run `sum init`
  - run `sum check`

No filesystem pollution after tests.

---

## Estimated Complexity

- **Time**: M
- **Risk**: Medium (filesystem + naming edge cases)
- **Suggested Model**: **GPT-5.2** or **Claude Opus**
  (Needs careful reasoning, not brute force coding)

---
