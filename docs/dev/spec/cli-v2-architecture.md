# SUM CLI v2: Enhanced Architecture

**Version:** 2.0.0  
**Date:** December 18, 2025  
**Status:** Implementation Ready

## Executive Summary

CLI v2 transforms the developer experience from a 9-step manual process to a single command that delivers a fully-functioning site ready for theme testing. This dramatically improves development velocity, especially for AI agents performing rapid smoke tests.

### The Problem
```bash
# Current v1 flow (9 manual steps)
sum init acme-test
cd clients/acme-test
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
# ‚Üí Navigate to admin
# ‚Üí Create homepage manually
# ‚Üí Set as site root page
# ‚Üí Finally see themed site
```

### The Solution
```bash
# Enhanced v2 flow (1 command)
sum init acme-kitchens --full
# ‚Üí Ready to view themed site at http://127.0.0.1:8000/
```

---

## Core Design Decisions

### 1. Virtualenv Location: `.venv`
**Rationale:** AI agents default to `.venv`, keeps things predictable

### 2. Superuser Credentials: `.env.local`
**Rationale:** 
- Not committed to git (in `.gitignore`)
- Easily accessible for development
- Can be rotated for production without touching `.env.example`

**Format:**
```bash
# .env.local (auto-generated)
# Generated by sum init on 2025-12-18
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@example.com
DJANGO_SUPERUSER_PASSWORD=admin
```

### 3. Homepage Seeding Strategy
**Phase 1:** Default seed command (works for all clients)
**Phase 2:** Per-client seed configurations

```python
# Phase 1: Default seed (core/sum_core/management/commands/seed_homepage.py)
python manage.py seed_homepage

# Phase 2: Client-specific seed (future)
python manage.py seed_homepage --preset=premium-trade
python manage.py seed_homepage --config=clients/acme/seed.json
```

### 4. Execution Modes
Same as v1, but now handles runtime operations:

**Monorepo Dev Mode:**
- Detected by presence of `core/` and `boilerplate/`
- Uses repo's virtualenv
- Adds `sum_core` to PYTHONPATH
- Perfect for platform development

**Standalone Client Mode:**
- Running outside monorepo
- Uses client's `.venv`
- Requires `sum_core` from pip
- Perfect for deployed clients

---

## CLI Commands

### `sum init <project-name> [OPTIONS]`

Creates a new client project with optional full setup.

#### Flags

| Flag | Description | Default |
|------|-------------|---------|
| `--full` | Run complete setup (venv, deps, migrations, seed, superuser) | `false` |
| `--no-prompt` | Non-interactive mode, use all defaults | `false` |
| `--ci` | Optimized for CI: non-interactive, fail-fast, clear output | `false` |
| `--quick` | Scaffold + venv + deps only (no database operations) | `false` |
| `--skip-venv` | Skip virtualenv creation | `false` |
| `--skip-migrations` | Skip database migrations | `false` |
| `--skip-seed` | Skip homepage seeding | `false` |
| `--skip-superuser` | Skip superuser creation | `false` |
| `--run` | Start development server after setup | `false` |

#### Examples

```bash
# Full interactive setup
sum init acme-kitchens --full

# Quick setup (no DB operations)
sum init acme-kitchens --quick

# CI mode (non-interactive, optimized output)
sum init acme-kitchens --full --ci

# Skip specific steps
sum init acme-kitchens --full --skip-seed --skip-superuser

# Initialize and start server immediately
sum init acme-kitchens --full --run
```

#### Interactive Flow (--full mode)

```
üöÄ Initializing project: acme-kitchens

[1/8] Scaffolding project structure... ‚úÖ
[2/8] Validating structure... ‚úÖ
[3/8] Creating virtualenv (.venv)... ‚úÖ
[4/8] Installing dependencies... ‚è≥ (this may take a minute)
[4/8] Installing dependencies... ‚úÖ

Setup Python environment? (Y/n): y
Run database migrations? (Y/n): y
[5/8] Running migrations... ‚úÖ

Seed initial homepage? (Y/n): y
[6/8] Creating homepage... ‚úÖ

Create superuser? (Y/n): y
Username [admin]: admin
Email [admin@example.com]: 
Password [admin]: 
[7/8] Creating superuser... ‚úÖ

Start development server? (Y/n): y
[8/8] Starting server... ‚úÖ

üéâ Project 'acme-kitchens' is ready!

üìç Location: /path/to/clients/acme-kitchens
üîó URL: http://127.0.0.1:8000/
üë§ Admin: admin / admin (stored in .env.local)
üìù Credentials: clients/acme-kitchens/.env.local

Next steps:
  cd clients/acme-kitchens
  source .venv/bin/activate
  python manage.py runserver  # if not already running

Or use:
  sum run acme-kitchens
```

### `sum check [PATH]`

Enhanced validation with additional checks.

**New checks:**
- Virtualenv exists and has correct packages
- `.env.local` exists (if superuser was created)
- Database is migrated (checks `django_migrations` table)
- Homepage exists and is set as site root

**Example output:**
```
Running checks for: /path/to/clients/acme-kitchens

[OK] Project root: manage.py found
[OK] Env template: .env.example found
[OK] Required env vars: All set
[OK] Settings module: Importable
[OK] Health wiring: URLConf includes sum_core.ops.urls
[OK] sum_core import: monorepo mode
[OK] Virtualenv: .venv exists with required packages
[OK] Credentials: .env.local found
[OK] Database: Migrations up to date
[OK] Homepage: Set as site root page
[SKIP] test_project refs: Not in project files

‚úÖ All checks passed
```

### `sum run [PROJECT]`

Convenience command to run development server.

**Features:**
- Auto-detects virtualenv and activates it
- Uses correct Python executable for mode
- Handles port conflicts (tries 8000, 8001, 8002...)
- Shows clear startup message

**Examples:**
```bash
# From within a client project
cd clients/acme-kitchens
sum run

# From anywhere in monorepo
sum run acme-kitchens

# Specify custom port
sum run --port 8001
```

**Output:**
```
üöÄ Starting acme-kitchens...

Using virtualenv: /path/to/clients/acme-kitchens/.venv
Mode: monorepo
Python: /path/to/.venv/bin/python3.12

Django version 5.2.1, using settings 'acme_kitchens.settings.local'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
```

---

## Implementation Architecture

### File Structure

```
cli/
‚îú‚îÄ‚îÄ setup.py
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ sum/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ cli.py              # Main Click entrypoint
‚îÇ   ‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ init.py         # sum init (enhanced)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ check.py        # sum check (enhanced)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ run.py          # sum run (new)
‚îÇ   ‚îú‚îÄ‚îÄ setup/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orchestrator.py # Setup flow orchestration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ venv.py         # Virtualenv operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py         # Dependency installation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py     # Migration operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seed.py         # Homepage seeding
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py         # Superuser creation
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ environment.py  # Mode detection (monorepo vs standalone)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompts.py      # Interactive prompts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ output.py       # Formatted output (progress, errors)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ django.py       # Django command execution
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.py   # Enhanced validation checks
‚îÇ   ‚îî‚îÄ‚îÄ boilerplate/        # Bundled boilerplate copy
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_init.py
    ‚îú‚îÄ‚îÄ test_check.py
    ‚îú‚îÄ‚îÄ test_run.py
    ‚îî‚îÄ‚îÄ fixtures/
```

### Key Modules

#### 1. `setup/orchestrator.py`
Central coordinator for the setup flow. Handles:
- Step sequencing
- Progress tracking
- Error recovery
- Idempotent operations (skip if already done)

```python
class SetupOrchestrator:
    """Orchestrates the full project setup flow."""
    
    def __init__(self, project_path: Path, mode: ExecutionMode):
        self.project_path = project_path
        self.mode = mode
        self.progress = ProgressTracker(total_steps=8)
        
    def run_full_setup(self, config: SetupConfig) -> SetupResult:
        """Run complete setup based on configuration."""
        steps = [
            ("Scaffolding structure", self._scaffold),
            ("Validating structure", self._validate),
            ("Creating virtualenv", self._setup_venv),
            ("Installing dependencies", self._install_deps),
            ("Running migrations", self._migrate),
            ("Seeding homepage", self._seed_content),
            ("Creating superuser", self._create_superuser),
            ("Starting server", self._start_server),
        ]
        
        for step_name, step_func in steps:
            if self._should_skip_step(step_name, config):
                self.progress.skip(step_name)
                continue
                
            self.progress.start(step_name)
            try:
                step_func(config)
                self.progress.complete(step_name)
            except SetupError as e:
                self.progress.fail(step_name, str(e))
                raise
```

#### 2. `setup/venv.py`
Virtualenv creation and management.

```python
class VenvManager:
    """Manages Python virtual environments."""
    
    def create(self, project_path: Path) -> Path:
        """Create .venv if it doesn't exist."""
        venv_path = project_path / ".venv"
        
        if venv_path.exists():
            logger.info(f"Virtualenv already exists: {venv_path}")
            return venv_path
            
        # Create virtualenv
        subprocess.run(
            [sys.executable, "-m", "venv", str(venv_path)],
            check=True
        )
        
        return venv_path
    
    def get_python_executable(self, project_path: Path) -> Path:
        """Get path to virtualenv Python."""
        venv_path = project_path / ".venv"
        return venv_path / "bin" / "python"
    
    def is_activated(self) -> bool:
        """Check if we're in a virtualenv."""
        return sys.prefix != sys.base_prefix
```

#### 3. `setup/database.py`
Migration execution and validation.

```python
class DatabaseManager:
    """Manages database operations."""
    
    def __init__(self, django_executor: DjangoCommandExecutor):
        self.django = django_executor
    
    def migrate(self) -> MigrationResult:
        """Run database migrations."""
        result = self.django.run_command(["migrate", "--noinput"])
        
        if result.returncode != 0:
            raise MigrationError(f"Migration failed: {result.stderr}")
            
        return MigrationResult(
            success=True,
            output=result.stdout
        )
    
    def check_migrations(self) -> bool:
        """Check if migrations are up to date."""
        result = self.django.run_command(
            ["migrate", "--check"],
            check=False
        )
        return result.returncode == 0
    
    def get_migration_status(self) -> MigrationStatus:
        """Get detailed migration status."""
        result = self.django.run_command(["showmigrations", "--plan"])
        # Parse output to determine status
        return self._parse_migration_status(result.stdout)
```

#### 4. `setup/seed.py`
Homepage seeding operations.

```python
class ContentSeeder:
    """Seeds initial Wagtail content."""
    
    def __init__(self, django_executor: DjangoCommandExecutor):
        self.django = django_executor
    
    def seed_homepage(self, preset: Optional[str] = None) -> SeedResult:
        """Create initial homepage."""
        cmd = ["seed_homepage"]
        if preset:
            cmd.extend(["--preset", preset])
            
        result = self.django.run_command(cmd)
        
        if result.returncode != 0:
            raise SeedError(f"Seeding failed: {result.stderr}")
            
        return SeedResult(success=True, page_id=self._extract_page_id(result.stdout))
    
    def check_homepage_exists(self) -> bool:
        """Check if homepage is already created."""
        # Could use Django command or direct DB check
        pass
```

#### 5. `setup/auth.py`
Superuser creation with `.env.local` storage.

```python
class SuperuserManager:
    """Manages Django superuser creation."""
    
    def create(
        self,
        username: str = "admin",
        email: str = "admin@example.com",
        password: str = "admin"
    ) -> SuperuserResult:
        """Create superuser and store credentials."""
        
        # Create via Django command
        result = self.django.run_command([
            "createsuperuser",
            "--noinput",
            "--username", username,
            "--email", email,
        ], env={"DJANGO_SUPERUSER_PASSWORD": password})
        
        if result.returncode != 0:
            raise SuperuserError(f"Creation failed: {result.stderr}")
        
        # Store in .env.local
        self._save_credentials(username, email, password)
        
        return SuperuserResult(
            success=True,
            username=username,
            credentials_path=self.project_path / ".env.local"
        )
    
    def _save_credentials(self, username: str, email: str, password: str):
        """Save credentials to .env.local."""
        env_local = self.project_path / ".env.local"
        
        content = f"""# .env.local
# Auto-generated by sum init on {datetime.now().strftime('%Y-%m-%d')}
# DO NOT COMMIT THIS FILE
DJANGO_SUPERUSER_USERNAME={username}
DJANGO_SUPERUSER_EMAIL={email}
DJANGO_SUPERUSER_PASSWORD={password}
"""
        env_local.write_text(content)
```

#### 6. `utils/prompts.py`
Interactive prompt system.

```python
class PromptManager:
    """Handles interactive user prompts."""
    
    def __init__(self, no_prompt: bool = False, ci: bool = False):
        self.no_prompt = no_prompt
        self.ci = ci
    
    def confirm(
        self,
        message: str,
        default: bool = True
    ) -> bool:
        """Prompt for yes/no confirmation."""
        
        if self.no_prompt or self.ci:
            return default
            
        suffix = " (Y/n)" if default else " (y/N)"
        response = input(f"{message}{suffix}: ").strip().lower()
        
        if not response:
            return default
            
        return response in ['y', 'yes']
    
    def text(
        self,
        message: str,
        default: Optional[str] = None
    ) -> str:
        """Prompt for text input."""
        
        if self.no_prompt or self.ci:
            return default or ""
            
        suffix = f" [{default}]" if default else ""
        response = input(f"{message}{suffix}: ").strip()
        
        return response or default or ""
```

#### 7. `utils/output.py`
Formatted output with progress tracking.

```python
class OutputFormatter:
    """Formats CLI output consistently."""
    
    @staticmethod
    def progress(step: int, total: int, message: str, status: str = "‚è≥"):
        """Show progress indicator."""
        print(f"[{step}/{total}] {message}... {status}")
    
    @staticmethod
    def success(message: str):
        """Show success message."""
        print(f"‚úÖ {message}")
    
    @staticmethod
    def error(message: str):
        """Show error message."""
        print(f"‚ùå {message}", file=sys.stderr)
    
    @staticmethod
    def info(message: str):
        """Show info message."""
        print(f"‚ÑπÔ∏è  {message}")
    
    @staticmethod
    def summary(project_name: str, data: dict):
        """Show final summary box."""
        print("\n" + "="*60)
        print(f"üéâ Project '{project_name}' is ready!")
        print("="*60)
        print(f"\nüìç Location: {data['location']}")
        print(f"üîó URL: {data['url']}")
        print(f"üë§ Admin: {data['username']} / {data['password']}")
        print(f"üìù Credentials: {data['credentials_path']}")
        print("\nNext steps:")
        print(f"  cd {data['relative_path']}")
        print(f"  source .venv/bin/activate")
        print(f"  python manage.py runserver  # if not running")
        print(f"\nOr use:")
        print(f"  sum run {project_name}")
        print()
```

#### 8. `utils/django.py`
Django command execution abstraction.

```python
class DjangoCommandExecutor:
    """Executes Django management commands."""
    
    def __init__(self, project_path: Path, mode: ExecutionMode):
        self.project_path = project_path
        self.mode = mode
    
    def run_command(
        self,
        command: List[str],
        env: Optional[Dict[str, str]] = None,
        check: bool = True
    ) -> subprocess.CompletedProcess:
        """Run a Django management command."""
        
        python = self._get_python_executable()
        full_command = [str(python), "manage.py"] + command
        
        # Build environment
        command_env = os.environ.copy()
        
        if self.mode == ExecutionMode.MONOREPO:
            # Add sum_core to Python path
            command_env['PYTHONPATH'] = str(self._get_core_path())
        
        if env:
            command_env.update(env)
        
        result = subprocess.run(
            full_command,
            cwd=self.project_path,
            env=command_env,
            capture_output=True,
            text=True,
            check=check
        )
        
        return result
    
    def _get_python_executable(self) -> Path:
        """Get correct Python executable for current mode."""
        if self.mode == ExecutionMode.MONOREPO:
            return Path(sys.executable)
        else:
            venv_python = self.project_path / ".venv" / "bin" / "python"
            if venv_python.exists():
                return venv_python
            raise ValueError("Virtualenv not found")
```

---

## Management Command: `seed_homepage`

This command lives in `core/sum_core/management/commands/seed_homepage.py`.

### Features
- Creates a HomePage instance with theme-appropriate content
- Sets as site root page
- Idempotent (checks if already exists)
- Supports presets (Phase 2)

### Implementation

```python
"""
File: core/sum_core/management/commands/seed_homepage.py
Purpose: Create initial homepage for new client projects
Dependencies: wagtail.models, home.models
"""

from django.core.management.base import BaseCommand, CommandError
from wagtail.models import Page, Site
from home.models import HomePage


class Command(BaseCommand):
    help = 'Seed initial homepage for a new client project'

    def add_arguments(self, parser):
        parser.add_argument(
            '--preset',
            type=str,
            help='Theme preset name (premium-trade, professional-blue, etc.)',
            required=False
        )
        parser.add_argument(
            '--force',
            action='store_true',
            help='Recreate homepage even if it exists'
        )

    def handle(self, *args, **options):
        preset = options.get('preset')
        force = options.get('force', False)
        
        # Check if homepage already exists
        existing = HomePage.objects.filter(slug='home').first()
        
        if existing and not force:
            self.stdout.write(
                self.style.WARNING(
                    f'Homepage already exists (ID: {existing.id}). '
                    'Use --force to recreate.'
                )
            )
            return
        
        if existing and force:
            self.stdout.write('Removing existing homepage...')
            existing.delete()
        
        # Get root page
        root = Page.get_first_root_node()
        
        # Create homepage with appropriate content
        homepage = HomePage(
            title="Welcome",
            slug="home",
            seo_title="Home",
            search_description="Welcome to our website",
            # Add StreamField content based on preset
            body=self._get_default_content(preset)
        )
        
        root.add_child(instance=homepage)
        
        # Set as site root
        site = Site.objects.get(is_default_site=True)
        site.root_page = homepage
        site.save()
        
        self.stdout.write(
            self.style.SUCCESS(
                f'‚úÖ Homepage created successfully (ID: {homepage.id})'
            )
        )
        self.stdout.write(f'   URL: http://127.0.0.1:8000/')
    
    def _get_default_content(self, preset: Optional[str]):
        """Get default StreamField content for homepage."""
        # This would return appropriate blocks based on preset
        # For now, return a simple hero + services layout
        return [
            {
                'type': 'hero_gradient',
                'value': {
                    'headline': 'Welcome to Your New Site',
                    'subheadline': 'Your professional website is ready to customize.',
                    'cta_buttons': []
                }
            },
            {
                'type': 'rich_text',
                'value': '<p>This is your homepage. Edit this content in the Wagtail admin.</p>'
            }
        ]
```

---

## Configuration System

### SetupConfig Dataclass

```python
from dataclasses import dataclass
from typing import Optional

@dataclass
class SetupConfig:
    """Configuration for setup orchestration."""
    
    # Operation flags
    full: bool = False
    quick: bool = False
    ci: bool = False
    no_prompt: bool = False
    
    # Skip flags
    skip_venv: bool = False
    skip_migrations: bool = False
    skip_seed: bool = False
    skip_superuser: bool = False
    
    # Runtime options
    run_server: bool = False
    port: int = 8000
    
    # Superuser credentials
    superuser_username: str = "admin"
    superuser_email: str = "admin@example.com"
    superuser_password: str = "admin"
    
    # Content options
    seed_preset: Optional[str] = None
    
    @classmethod
    def from_cli_args(cls, **kwargs) -> 'SetupConfig':
        """Create config from CLI arguments."""
        return cls(**kwargs)
```

---

## Error Handling

### Exception Hierarchy

```python
class SumCliError(Exception):
    """Base exception for CLI errors."""
    pass

class SetupError(SumCliError):
    """Setup operation failed."""
    pass

class VenvError(SetupError):
    """Virtualenv operation failed."""
    pass

class DependencyError(SetupError):
    """Dependency installation failed."""
    pass

class MigrationError(SetupError):
    """Migration operation failed."""
    pass

class SeedError(SetupError):
    """Content seeding failed."""
    pass

class SuperuserError(SetupError):
    """Superuser creation failed."""
    pass
```

### Error Recovery

```python
class ErrorHandler:
    """Handles errors gracefully with helpful messages."""
    
    @staticmethod
    def handle_setup_error(error: SetupError, step: str):
        """Handle setup errors with context."""
        
        error_messages = {
            VenvError: "Failed to create virtualenv. Check Python installation.",
            DependencyError: "Failed to install dependencies. Check network connection.",
            MigrationError: "Failed to run migrations. Check database connection.",
            SeedError: "Failed to seed content. Check database state.",
            SuperuserError: "Failed to create superuser. Check database permissions."
        }
        
        message = error_messages.get(type(error), str(error))
        
        print(f"\n‚ùå Error during '{step}': {message}")
        print("\nYou can:")
        print("  1. Fix the issue and re-run the command")
        print("  2. Continue manually from where it failed")
        print(f"  3. Run 'sum check' to diagnose the problem")
        
        sys.exit(1)
```

---

## Testing Strategy

### Unit Tests

```python
# tests/test_venv.py
def test_venv_creation(tmp_path):
    """Test virtualenv creation."""
    manager = VenvManager()
    venv_path = manager.create(tmp_path)
    
    assert venv_path.exists()
    assert (venv_path / "bin" / "python").exists()

def test_venv_already_exists(tmp_path):
    """Test idempotent venv creation."""
    manager = VenvManager()
    venv_path1 = manager.create(tmp_path)
    venv_path2 = manager.create(tmp_path)
    
    assert venv_path1 == venv_path2

# tests/test_prompts.py
def test_confirm_default_yes():
    """Test confirmation with default yes."""
    prompts = PromptManager(no_prompt=True)
    assert prompts.confirm("Test?", default=True) is True

def test_confirm_ci_mode():
    """Test CI mode always uses defaults."""
    prompts = PromptManager(ci=True)
    assert prompts.confirm("Test?", default=False) is False
```

### Integration Tests

```python
# tests/test_init_full.py
def test_full_init_creates_working_project(monorepo_fixture):
    """Test full init creates a working project."""
    result = subprocess.run(
        ["sum", "init", "test-project", "--full", "--ci"],
        cwd=monorepo_fixture,
        capture_output=True
    )
    
    assert result.returncode == 0
    
    project_path = monorepo_fixture / "clients" / "test-project"
    assert project_path.exists()
    assert (project_path / ".venv").exists()
    assert (project_path / ".env.local").exists()
    
    # Check homepage was created
    # ... more assertions
```

---

## Implementation Phases

### Phase 1: Core Setup (Week 1)
**Goal:** Eliminate manual steps

**Tasks:**
1. ‚úÖ Refactor current `sum init` into modular functions
2. ‚úÖ Implement `setup/venv.py` - virtualenv management
3. ‚úÖ Implement `setup/deps.py` - dependency installation
4. ‚úÖ Implement `setup/database.py` - migrations
5. ‚úÖ Implement `setup/auth.py` - superuser + `.env.local`
6. ‚úÖ Implement `utils/prompts.py` - interactive prompts
7. ‚úÖ Implement `utils/output.py` - formatted output
8. ‚úÖ Implement `utils/django.py` - command execution
9. ‚úÖ Add `--full`, `--no-prompt`, `--ci` flags
10. ‚úÖ Test thoroughly

**Success Criteria:**
- `sum init project --full --ci` creates a working project in one command
- All steps are idempotent (can be re-run safely)
- Clear progress indicators throughout
- Helpful error messages with recovery suggestions

### Phase 2: Content Seeding (Week 2)
**Goal:** Land on themed homepage, not Wagtail default

**Tasks:**
1. ‚úÖ Create `seed_homepage` management command in `sum_core`
2. ‚úÖ Implement default homepage content (hero + rich text)
3. ‚úÖ Integrate into `setup/seed.py`
4. ‚úÖ Add to CLI flow with prompt
5. ‚úÖ Test with real theme

**Success Criteria:**
- After `sum init --full`, visiting `http://127.0.0.1:8000/` shows themed homepage
- No manual admin steps required
- Homepage uses appropriate StreamField blocks

### Phase 3: Polish & `sum run` (Week 3)
**Goal:** Maximum convenience

**Tasks:**
1. ‚úÖ Implement `commands/run.py` - `sum run` command
2. ‚úÖ Add smart detection (skip completed steps)
3. ‚úÖ Enhanced `sum check` with new validations
4. ‚úÖ Better error messages and recovery
5. ‚úÖ Port conflict handling
6. ‚úÖ Documentation updates

**Success Criteria:**
- `sum run` works from anywhere in monorepo
- Auto-detects and handles port conflicts
- Enhanced `sum check` catches common issues
- All error messages have clear next steps

### Phase 4: Client Presets (Future - Week 4+)
**Goal:** Per-client seed configurations

**Tasks:**
1. Define preset system architecture
2. Create preset files for each theme preset
3. Add `--preset` flag to `seed_homepage`
4. Update CLI to pass preset option
5. Create preset templates

---

## Backward Compatibility

**v1 behavior is preserved:**
```bash
sum init project-name  # Still just scaffolds, no DB operations
```

**v2 is opt-in:**
```bash
sum init project-name --full  # New enhanced flow
```

This ensures existing workflows aren't broken while enabling the new enhanced experience.

---

## CI/CD Integration

### GitHub Actions Example

```yaml
name: Test Client Project

on: [push]

jobs:
  test-init:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      
      - name: Install CLI
        run: |
          pip install -e ./cli
      
      - name: Create test project
        run: |
          sum init test-project --full --ci
      
      - name: Run checks
        run: |
          cd clients/test-project
          sum check
      
      - name: Test homepage
        run: |
          cd clients/test-project
          source .venv/bin/activate
          python manage.py runserver &
          sleep 5
          curl http://127.0.0.1:8000/ | grep "Welcome"
```

---

## Documentation Updates Required

1. **README.md** - Add `--full` examples
2. **cli.md** - Document all new flags and commands
3. **CONTRIBUTING.md** - Update development workflow
4. **FAQ.md** - Add common issues and solutions

---

## Success Metrics

### Developer Experience
- **Time to working site:** <2 minutes (down from ~10 minutes)
- **Manual steps:** 1 command (down from 9 steps)
- **AI agent friction:** Eliminated (no manual intervention)

### Quality
- **Error rate:** <5% on first run
- **Test coverage:** >80% for new modules
- **Idempotency:** 100% (can always re-run safely)

---

## Open Questions

1. **Virtualenv Python version:** Should we detect and use Python 3.12+ specifically?
2. **Database backend:** Should we support SQLite for quick dev mode?
3. **Parallel operations:** Can we install deps while running migrations?
4. **Undo/rollback:** Should we support `sum init --undo` to clean up failed init?
5. **Logs:** Should we log setup operations to a file for debugging?

---

## Appendix: Command Reference

### Full Command Syntax

```bash
sum init <project-name> [OPTIONS]

OPTIONS:
  --full              Run complete setup
  --quick             Scaffold + venv + deps only
  --no-prompt         Non-interactive mode
  --ci                CI mode (non-interactive, optimized)
  --skip-venv         Skip virtualenv creation
  --skip-migrations   Skip database migrations
  --skip-seed         Skip homepage seeding
  --skip-superuser    Skip superuser creation
  --run               Start server after setup
  --port PORT         Development server port (default: 8000)
  --preset PRESET     Content preset name
  --help              Show help message

sum check [PATH]
  Validate project structure and setup

sum run [PROJECT]
  Start development server

OPTIONS:
  --port PORT         Development server port (default: 8000)
  --help              Show help message
```

---

**This architecture is ready for implementation. Shall we proceed with Phase 1?**
