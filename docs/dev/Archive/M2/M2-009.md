## [M2-009] Gallery / Portfolio Block (BLOCKS-008 – US-B07)

> **Goal:** Implement the “Selected Works / Project Gallery” block so editors can showcase projects in a responsive grid, fully aligned with the SUM design system and token rules.

### Context (from PRD)

From the StreamField blocks epic and homepage requirements, the homepage and standard pages must support a gallery block to showcase projects.

Key PRD expectations (paraphrased):

* Homepage and Standard pages must support a **Gallery block** to showcase projects.
* Gallery should use images, titles, and optional metadata (location, services, etc.).
* Must be available on `HomePage` and re-usable on other StreamField-based pages later.
* Fully responsive, consistent with the rest of the design system.

The code review also notes an existing `PortfolioBlock` whose template is missing (`portfolio.html`). That’s the natural anchor for this work.

### Technical Requirements (from Tech Spec / Implementation Plan)

**Block layer**

* Reuse and/or refine the existing `PortfolioBlock` in `core/sum_core/blocks/content.py` (or equivalent) rather than inventing a new block name – this keeps us aligned with the code review and avoids orphaned blocks.
* Ensure `PortfolioBlock` (our Gallery block) supports at least:

  * Section framing fields:

    * `eyebrow` (short label, optional)
    * `heading` (rich text, required; H2 semantics)
    * `intro` (short lead paragraph, optional)
  * Items:

    * A `ListBlock` of `PortfolioItemBlock`/`GalleryItemBlock` (struct) with:

      * `image` (required; `ImageChooserBlock`)
      * `alt_text` (required string)
      * `title` (required)
      * Optional fields such as `location`, `services`, `short_description`, `link_url` (for “View project”).
    * Sensible constraints: e.g. `min_num=1`, `max_num` around 12.
* Make sure the block is exposed via `PageStreamBlock` so it’s usable on `HomePage` (and later on other pages).

**Template layer**

* Implement `core/sum_core/templates/sum_core/blocks/portfolio.html` as the **single template** for this block (this is the file called out as missing in the code review).

* Follow the **standard section & header pattern** from the CSS architecture doc:

  ```html
  <section class="section gallery">
    <div class="container">
      <header class="section__header reveal-group">
        {% if self.eyebrow %}
          <span class="section__eyebrow">{{ self.eyebrow }}</span>
        {% endif %}
        {% if self.heading %}
          <div class="section__heading">{{ self.heading|richtext }}</div>
        {% endif %}
        {% if self.intro %}
          <p class="section__intro text-body">{{ self.intro }}</p>
        {% endif %}
      </header>

      <div class="gallery__grid">
        {# cards here #}
      </div>
    </div>
  </section>
  ```

* Implement card markup per item:

  * Wrap each card in `.gallery__item` with:

    * Image wrapper for aspect-ratio and reveal animation.
    * Optional meta row (e.g. location, services).
    * Project title using appropriate typography role (probably `.heading-md` or `.heading-sm`).
    * Optional “View project” link / button using the generic button styles (`.btn`, `.btn-secondary`), **not** bespoke CTA styles.

* Use existing reveal / animation utilities instead of inlining any IntersectionObserver JS (the system already has a shared observer & `.is-in-view` pattern).

**CSS / design system**

* Create `core/sum_core/static/sum_core/css/components.gallery.css` and import it from `main.css` (or `components/index.css` depending on how you’ve modularised). Follow the guidance in `css-architecture-and-tokens.md`.

* Use the **standard 1/2/3 grid** pattern (same as services and testimonials):

  * Mobile `<768px`: 1 column
  * Tablet `≥768px`: 2 columns
  * Desktop `≥1024px`: 3 columns

  Example:

  ```css
  .gallery__grid {
    display: grid;
    gap: var(--space-6);
  }

  @media (min-width: 48rem) {
    .gallery__grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (min-width: 64rem) {
    .gallery__grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
  ```

* Use only **token-based values**:

  * Spacing: `var(--space-*)`
  * Colours (HSL tuples): e.g. `background-color: hsla(var(--surface-tint), 1);`, `color: hsla(var(--text-main), 1);`, `border-color: hsla(var(--accent-pop), 1);`
  * Radii: `var(--radius-*)`
  * Shadows: `var(--shadow-*)`

* Typography:

  * Do **not** define `font-size` / `font-family` directly in `components.gallery.css`.
  * For the section header, rely on the shared `.section__header` styles.
  * For card titles and body text, use the existing typography utility classes (`.heading-sm`, `.text-body`, `.text-sm`, `.text-muted`, etc.).

* Interaction:

  * If you add subtle hover/scale effects on cards, keep them consistent with other blocks (e.g. testimonials) and use transitions defined via tokens (timings from `tokens.css` such as `var(--ease-out-expo)`, not arbitrary cubic-beziers).

**Design Specifications (visual behaviour)**

Grounded in:

* The design system & token doc (`docs/dev/design/css-architecture-and-tokens.md`)
* The design implementation workflow (`docs/dev/design/design-implementation.md`)
* The general Premium Trade homepage reference (`premium-trade-website-v3-final.html`) – gallery / “Selected Works” section.

Visual expectations:

* Section header:

  * Uses `.section__header` with eyebrow, heading (rich text), intro; visually consistent with Services, Testimonials, Process/FAQ, and Content blocks.
* Cards:

  * Strong image-led tiles with subtle hover (e.g. slight lift + shadow or brightness change).
  * Project title as the dominant text; location/services as small meta beneath in muted style.
  * Optional “View project” link styled as a **link button** using the shared `.btn` system where appropriate, *not* bespoke CTA classes.

### Implementation Guidelines

**Files to create / modify**

* **Blocks (Python)**

  * `core/sum_core/blocks/content.py`

    * Ensure `PortfolioBlock` exists, is up to date, and fields map cleanly to what the gallery needs.
    * If necessary, introduce/adjust `PortfolioItemBlock` and wire into `PortfolioBlock` via `ListBlock`.
  * `core/sum_core/blocks/__init__.py`

    * Export `PortfolioBlock` if not already exported.
  * `core/sum_core/blocks/base.py`

    * Confirm `PageStreamBlock` includes a `portfolio` or `gallery` child block for this block, grouped appropriately (e.g. `group="Sections"`).

* **Templates**

  * `core/sum_core/templates/sum_core/blocks/portfolio.html`

    * Implement section structure, header, grid, and cards.

* **CSS**

  * `core/sum_core/static/sum_core/css/components.gallery.css`

    * New component stylesheet containing all styles specific to the gallery block.
  * `core/sum_core/static/sum_core/css/main.css` (or `components/index.css`)

    * Import the new `components.gallery.css`.

* **Tests**

  * `tests/blocks/test_gallery_block.py`

    * New unit tests for `PortfolioBlock` structure and validation.
  * `tests/templates/test_gallery_rendering.py`

    * New template/integration tests asserting correct rendering inside `HomePage` (and/or a simple dummy page).

**Required header comments (Python & CSS)**

All new Python and CSS files should use the standard header comment format, for example:

```python
"""
Name: Portfolio / Gallery Blocks
Path: core/sum_core/blocks/content.py
Purpose: StreamField blocks for project gallery / portfolio sections.
Family: SUM Platform – StreamField Blocks
Dependencies: wagtail.blocks, sum_core.blocks.base, sum_core.tokens
"""
```

```css
/* ==========================================================================
   Name: Gallery / Portfolio Section
   Path: core/sum_core/static/sum_core/css/components.gallery.css
   Purpose: Styles for the project gallery / portfolio grid block.
   Family: SUM Platform Design System – Components
   Dependencies: tokens.css, typography.css, layout.css
   ========================================================================== */
```

### Acceptance Criteria

**Functional**

* `PortfolioBlock` (Gallery block) is available in `PageStreamBlock` and can be added to `HomePage` via the Wagtail admin StreamField chooser.
* Editors can:

  * Set `eyebrow`, `heading`, and `intro`.
  * Add at least 1–12 gallery items, each with image, alt text, title, and optional metadata.
* Template renders **without errors** on:

  * `HomePage` with gallery block present.
* Images:

  * Render using Wagtail image tags (`{% image %}`) with appropriate renditions.
  * Always include alt text from the block (no empty alt).

**Design / front-end**

* Section uses `.section` + `.container` and the `.section__header` pattern exactly as documented.
* Cards follow the 1/2/3 grid pattern and collapse correctly from desktop to mobile.
* All spacing, colours, radii, and shadows use tokens via `var(--space-*)` and `hsla(var(--… ), 1)` – no hex, no raw px sizes for type.
* No `style=""` attributes in the template.
* No `font-family` / `font-size` / `line-height` defined in `components.gallery.css`.
* Buttons/links inside the gallery use the shared `.btn` system and inherit the global updated button behaviour from the Content Blocks work, not bespoke styles.

**Testing**

* `tests/blocks/test_gallery_block.py`:

  * Asserts `PortfolioBlock` can be instantiated.
  * Verifies presence and types of child blocks (heading, intro, items etc.).
  * Verifies list constraints (`min_num`, `max_num`) on items.
  * Confirms `image` is required and `alt_text` cannot be blank.

* `tests/templates/test_gallery_rendering.py`:

  * Renders a `HomePage` with a populated gallery block using the test fixtures pattern already used for hero/services/testimonials.
  * Asserts:

    * `.section.gallery` exists.
    * `.section__header` contains the expected heading text.
    * At least one `.gallery__item` is rendered with an `<img>` element and title text.

* All tests pass via `pytest`.

* `make lint` passes with no new issues.

### Dependencies & Prerequisites

* **Must be complete first:**

  * M2-001 base blocks / `PageStreamBlock` (done).
  * Hero, ServiceCards, Testimonials, Process/FAQ, Content blocks, and design token system (done).
  * CSS modularisation & token usage guide (`css-architecture-and-tokens.md` and `design-implementation.md`) in place and followed.

No additional infrastructure dependencies.

### Testing Requirements

* **Unit tests**

  * For `PortfolioBlock` and item structure in `tests/blocks/test_gallery_block.py`.
* **Integration / template tests**

  * For `HomePage` with gallery block: `tests/templates/test_gallery_rendering.py`.
* **Manual testing checklist**

  * Add a gallery block to `HomePage` in Wagtail admin with:

    * 1 item, then 3 items, then ~9 items – verify layout automatically adapts.
    * Different combinations of metadata (with/without intro, with/without location/services).
  * Resize the browser:

    * Mobile: single column.
    * Tablet: 2 columns.
    * Desktop: 3 columns.
  * Switch theme preset in SiteSettings:

    * Verify gallery colours and typography respond correctly (no hardcoded fonts/colours).
  * Check contrast and hover states feel consistent with services/testimonials.
