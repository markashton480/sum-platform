Milestone 3 is where the platform stops being “a library of blocks” and becomes an actual CMS product: **all page types + the full lead-management pipeline (capture → attribute → store → notify → manage in admin)**. The Implementation Plan explicitly calls out **page mixins** as a core Milestone 3 deliverable (`SeoFieldsMixin`, `OpenGraphMixin`, `BreadcrumbMixin`).

Here’s the first task for Milestone 3.

---

## **[M3-001] Base Page Mixins (SEO + Open Graph + Breadcrumbs)**

**Context (from PRD)**

* Pages must support **SEO fields** (meta title, meta description) and **Open Graph** (including OG image with fallback rules).
* Technical SEO expectations include **canonical URLs** on all pages.

**Technical Requirements (from Implementation Plan / PRD)**

* Implement the Milestone 3 page mixins: `SeoFieldsMixin`, `OpenGraphMixin`, `BreadcrumbMixin`.
* OG image fallback must be: **page OG image → page featured image → SiteSettings default OG image**. (SiteSettings includes `og_default_image`.)
* Meta title default should be **page title + site name**.
* Use the project’s prescribed core structure (pages under `/core/sum_core/pages/` etc.).

**Design Specifications (relevant guardrails)**

* Nothing visual is required in frontend for this ticket, but any admin help text / labels should stay consistent and clear (we’ll keep the UI minimal and predictable per the “stable naming/vocabulary” guidance).

**Implementation Guidelines**

* **Files to create/modify (choose the existing pattern in repo):**

  * `/core/sum_core/pages/mixins.py` (or `/core/sum_core/pages/models/mixins.py` if that’s your established structure) – implement the three mixins.
  * `/core/sum_core/templates/sum_core/includes/meta_tags.html` – *minimal wiring* so new fields/methods can be consumed (don’t attempt full SEO-001 here).
* **Required header comments on any new/edited Python module:**

```python
"""
Name: [Module Name]
Path: [File path]
Purpose: [Brief description]
Family: [What depends on this]
Dependencies: [What this depends on]
"""
```

* Python: type hints everywhere practical (esp. mixin helper methods).
* Avoid adding new dependencies.

**Suggested mixin responsibilities (keep them small + composable)**

1. `SeoFieldsMixin`

   * Adds `meta_title` and `meta_description` fields (with sensible max lengths / help text).
   * Adds helper methods like:

     * `get_meta_title(site_settings) -> str` (fallback to `"{page.title} | {site_settings.company_name}"`).
     * `get_meta_description() -> str`.
     * `get_canonical_url(request=None) -> str` (return absolute URL if request provided; otherwise relative).
2. `OpenGraphMixin`

   * Adds `og_image` field (ForeignKey to Wagtail Image).
   * Adds:

     * `get_og_title(site_settings)`, `get_og_description()`
     * `get_og_image(site_settings)` implementing fallback: `self.og_image` → `self.featured_image` (if present on page) → `site_settings.og_default_image`.
3. `BreadcrumbMixin`

   * Adds `get_breadcrumbs() -> list[dict]` based on Wagtail ancestors (live/public), with `{title, url, is_current}`.

**Acceptance Criteria**

* [ ] `SeoFieldsMixin`, `OpenGraphMixin`, `BreadcrumbMixin` exist and can be mixed into Page models as described in Milestone 3 deliverables.
* [ ] Meta title default logic matches PRD (page title + site name).
* [ ] OG image fallback matches PRD (page OG → featured → SiteSettings default).
* [ ] Breadcrumb helper returns a deterministic ancestor trail for a nested page.
* [ ] Minimal template wiring exists so `meta_tags.html` can render title/description/canonical/OG basics without breaking existing pages (full SEO polish deferred to SEO-001).
* [ ] Tests added and passing.

**Dependencies & Prerequisites**

* Milestone 2 blocks complete (done). Milestone 3 depends on that.
* SiteSettings exists (from Milestone 1) and includes `og_default_image`.

**Testing Requirements (align to strategy)**

* **Unit tests**:

  * Meta title fallback behaviour.
  * OG image fallback chain (including “featured_image present” and “site default present”).
  * Breadcrumb list shape/order for a simple tree.
* **Integration test (lightweight, 1 scenario)**:

  * Create a simple page using a test Page model with these mixins, render it, and assert the head contains the expected meta/OG/canonical tags (basic coverage only).
* CI expectations: keep coverage in line with the project targets and don’t weaken tests to “make them pass.”

**Estimated Complexity**

* Time: **M** (matches plan: ~4–5h)
* Risk: **Medium** (touches cross-cutting page metadata that everything will depend on)

---
